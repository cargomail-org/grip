<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1259" height="1044"><desc>participant%20%22AS%22%20as%20AS%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Aentryspacing%201.0%0Anote%20over%20AS%3AAS%5Cn%E2%80%A2%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20AS%20issuer%20discovery%20mechanism%0AClient-%3EClient%3A1.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%2C%20e.g.%20urn%3Adomain%3Amta%3Aclientid%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20AS%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%0AAS%3C-Client%3A2.%20Send%20an%20HTTP%20request%20to%20the%20AS%20STS%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0AAS-%3EAS%3A3.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0AAS-%3EAS%3A4.%20AS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-AS%3A5.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3ERP%3A6.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20use%20WebFinger%20to%20locate%20the%20AS%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20AS%20matches%20the%20token%20issuer%5Cn%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20%20and%20the%20AS%20host%20domain%20must%20match%0ARP-%3EClient%3A8.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1259" height="1044"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 33.876698536 L 162.49128491765626 1008.9626801360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 528.7374259591927 33.876698536 L 528.7374259591927 1008.9626801360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 935.4835670007292 33.876698536 L 935.4835670007292 1008.9626801360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 145.43439523428884 6.835654304000002 L 179.5481746010237 6.835654304000002 L 179.5481746010237 33.876698536 L 145.43439523428884 33.876698536 L 145.43439523428884 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="156.34128482228883" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 504.33886957736945 6.835654304000002 L 553.135982341016 6.835654304000002 L 553.135982341016 33.876698536 L 504.33886957736945 33.876698536 L 504.33886957736945 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="515.2457591653695" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 918.376677603464 6.835654304000002 L 952.5904563979943 6.835654304000002 L 952.5904563979943 33.876698536 L 918.376677603464 33.876698536 L 918.376677603464 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="929.283567191464" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 145.43439523428884 1008.9626801360001 L 179.5481746010237 1008.9626801360001 L 179.5481746010237 1036.0037243680001 L 145.43439523428884 1036.0037243680001 L 145.43439523428884 1008.9626801360001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="156.34128482228883" y="1025.9512915680002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 504.33886957736945 1008.9626801360001 L 553.135982341016 1008.9626801360001 L 553.135982341016 1036.0037243680001 L 504.33886957736945 1036.0037243680001 L 504.33886957736945 1008.9626801360001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="515.2457591653695" y="1025.9512915680002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 918.376677603464 1008.9626801360001 L 952.5904563979943 1008.9626801360001 L 952.5904563979943 1036.0037243680001 L 918.376677603464 1036.0037243680001 L 918.376677603464 1008.9626801360001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="929.283567191464" y="1025.9512915680002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.0262164 53.981564135999996 L 310.9091639153125 53.981564135999996 L 319.9563534353125 63.02875365599999 L 319.9563534353125 107.259457976 L 5.0262164 107.259457976 L 5.0262164 53.981564135999996 M 310.9091639153125 53.981564135999996 L 310.9091639153125 63.02875365599999 L 319.9563534353125 63.02875365599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="88.15983565600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="98.21226845600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 322.6973604932943 122.338107176 L 725.7303019050912 122.338107176 L 734.7774914250912 131.38529669599998 L 734.7774914250912 195.720866616 L 322.6973604932943 195.720866616 L 322.6973604932943 122.338107176 M 725.7303019050912 122.338107176 L 725.7303019050912 131.38529669599998 L 734.7774914250912 131.38529669599998" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="136.41151309599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="146.46394589599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="156.51637869599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="166.56881149599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="176.62124429599993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.77076641329427" y="186.67367709599992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 775.0518236783854 210.799515816 L 1086.8681208030728 210.799515816 L 1095.9153103230728 219.84670533599999 L 1095.9153103230728 274.129842456 L 775.0518236783854 274.129842456 L 775.0518236783854 210.799515816 M 1086.8681208030728 210.799515816 L 1086.8681208030728 219.84670533599999 L 1095.9153103230728 219.84670533599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="789.1252295983854" y="224.872921736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="789.1252295983854" y="234.925354536" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="789.1252295983854" y="244.97778733599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="789.1252295983854" y="255.03022013599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="789.1252295983854" y="265.082652936" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="540.632804772526" y="289.20849165600004" width="313.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="299.26092445600005" width="165.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="309.3133572560001" width="198.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="319.3657900560001" width="391.33241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="329.4182228560001" width="151.56573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="339.47065565600013" width="228.41572373648438" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="349.52308845600015" width="298.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="359.5755212560002" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="369.6279540560002" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="540.632804772526" y="379.6803868560002" width="150.36573594351563" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="298.25568117600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="308.3081139760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="318.3605467760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="328.4129795760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token, e.g. urn:domain:mta:clientid</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="338.46541237600013" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="348.51784517600015" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="358.57027797600017" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="368.6227107760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="378.6751435760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.140669692526" y="388.72757637600023" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 528.7374259591927 392.748549496 L 568.9471571591927 392.748549496 L 568.9471571591927 405.81671213600004 L 537.013928964526 405.81671213600004" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(528.7374259591927,405.81671213600004) translate(-528.7374259591927,-405.81671213600004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 537.114453292526 401.62819846933337 L 528.7374259591927 405.81671213600004 L 537.114453292526 410.0052258026667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="185.75648441490884" y="420.895361336" width="285.9157237364844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="185.75648441490884" y="430.947794136" width="319.71574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="185.75648441490884" y="441.00022693600005" width="148.86573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="185.75648441490884" y="451.05265973600007" width="312.7324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="185.75648441490884" y="461.1050925360001" width="127.69906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="185.75648441490884" y="471.1575253360001" width="299.43238633414063" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="429.942550856" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Send an HTTP request to the AS STS endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="439.99498365600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="450.04741645600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="460.0998492560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="470.1522820560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="187.26434933490884" y="480.2047148560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 528.7374259591927 484.225687976 L 170.76778792298958 484.225687976" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,484.225687976) translate(-162.49128491765626,-484.225687976)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 480.03717430933335 L 162.49128491765626 484.225687976 L 170.8683122509896 488.4142016426667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="174.3866637309896" y="499.304337176" width="121.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="509.356769976" width="178.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="519.409202776" width="182.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="529.461635576" width="183.04907029410157" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="508.351526696" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="518.403959496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="528.456392296" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="538.508825096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 542.529798216 L 202.70101611765625 542.529798216 L 202.70101611765625 555.597960856 L 170.76778792298958 555.597960856" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,555.597960856) translate(-162.49128491765626,-555.597960856)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 551.4094471893333 L 162.49128491765626 555.597960856 L 170.8683122509896 559.7864745226667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="174.3866637309896" y="570.6766100560001" width="318.93238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="580.7290428560001" width="165.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="590.7814756560001" width="198.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="600.8339084560001" width="252.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="610.8863412560002" width="284.1657237364844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="620.9387740560002" width="131.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="630.9912068560002" width="228.41572373648438" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="641.0436396560002" width="234.2157267882422" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="651.0960724560002" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="661.1485052560002" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="671.2009380560003" width="150.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="681.2533708560003" width="315.53239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="691.3058036560003" width="285.8490733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="701.3582364560003" width="279.08241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="711.4106692560003" width="350.83241074820313" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="579.7237995760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="589.7762323760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="599.8286651760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="609.8810979760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="619.9335307760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="629.9859635760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="640.0383963760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="650.0908291760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="660.1432619760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="670.1956947760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="680.2481275760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="690.3005603760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="700.3529931760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="710.4054259760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="720.4578587760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 724.4788318960001 L 202.70101611765625 724.4788318960001 L 202.70101611765625 737.546994536 L 170.76778792298958 737.546994536" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,737.546994536) translate(-162.49128491765626,-737.546994536)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 733.3584808693333 L 162.49128491765626 737.546994536 L 170.8683122509896 741.7355082026668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="201.7898248690104" y="752.625643736" width="93.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="201.7898248690104" y="762.678076536" width="111.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="201.7898248690104" y="772.7305093360001" width="287.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="201.7898248690104" y="782.7829421360001" width="98.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="201.7898248690104" y="792.8353749360001" width="94.34906571646485" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="203.2976897890104" y="761.6728332560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="203.2976897890104" y="771.7252660560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="203.2976897890104" y="781.7776988560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="203.2976897890104" y="791.8301316560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="203.2976897890104" y="801.8825644560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 805.9035375760001 L 520.4609229538594 805.9035375760001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(528.7374259591927,805.9035375760001) translate(-528.7374259591927,-805.9035375760001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 520.3603986258594 801.7150239093334 L 528.7374259591927 805.9035375760001 L 520.3603986258594 810.0920512426668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="586.477631559961" y="820.9821867760002" width="291.26572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="587.985496479961" y="830.0293762960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 528.7374259591927 834.0503494160001 L 927.2070639953959 834.0503494160001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(935.4835670007292,834.0503494160001) translate(-935.4835670007292,-834.0503494160001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 927.1065396673959 829.8618357493334 L 935.4835670007292 834.0503494160001 L 927.1065396673959 838.2388630826669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="947.3789458140625" y="849.1289986160002" width="118.73239701529297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="859.1814314160002" width="147.24906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="869.2338642160003" width="157.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="879.2862970160003" width="258.0990580870703" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="889.3387298160003" width="308.99906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="899.3911626160003" width="24.415729458530272" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="909.4435954160003" width="236.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="947.3789458140625" y="919.4960282160004" width="197.76572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="858.1761881360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="868.2286209360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="878.2810537360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="888.3334865360004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. use WebFinger to locate the AS for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="898.3859193360004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        its identifier and verify that the AS matches the token issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="908.4383521360004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="918.4907849360004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="948.8868107340625" y="928.5432177360004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        and the AS host domain must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 935.4835670007292 932.5641908560002 L 975.6932982007291 932.5641908560002 L 975.6932982007291 945.6323534960002 L 943.7600700060625 945.6323534960002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(935.4835670007292,945.6323534960002) translate(-935.4835670007292,-945.6323534960002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 943.8605943340625 941.4438398293335 L 935.4835670007292 945.6323534960002 L 943.8605943340625 949.8208671626669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="579.2359628587891" y="960.7110026960003" width="305.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="580.7438277787891" y="969.7581922160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 935.4835670007292 973.7791653360002 L 537.013928964526 973.7791653360002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(528.7374259591927,973.7791653360002) translate(-528.7374259591927,-973.7791653360002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 537.114453292526 969.5906516693335 L 528.7374259591927 973.7791653360002 L 537.114453292526 977.967679002667 Z"/></g></g></g></g></svg>