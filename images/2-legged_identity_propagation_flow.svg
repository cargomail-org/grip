<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2037" height="1536"><desc>participant%20%22STS%22%20as%20STS%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3ASTS%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%2C%5Cn%20%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%2C%5Cn%20%20e.g.%2C%20OU%3D_fhir-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20STS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0AClient-%3EClient%3A1.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%2C%20e.g.%20urn%3Adomain%3Amta%3Aclientid%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20STS%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%0ASTS%3C-Client%3A2.%20Send%20an%20HTTP%20request%20to%20the%20STS%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0ASTS-%3ESTS%3A3.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A4.%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_fhir-client.sandbox.example.com%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-STS%3A5.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3ERP%3A6.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20use%20WebFinger%20to%20locate%20the%20STS%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20STS%20matches%20the%20token%20issuer%5Cn%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20%20and%20the%20STS%20host%20domain%20must%20match%0ARP-%3EClient%3A8.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2037" height="1536"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 50.815047804 L 254.26610218117185 1483.2867218039999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 50.815047804 L 881.5769793928906 1483.2867218039999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1520.3211451788281 50.815047804 L 1520.3211451788281 1483.2867218039999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 224.105767608437 10.253481456000003 L 284.4264367539067 10.253481456000003 L 284.4264367539067 50.815047804 L 224.105767608437 50.815047804 L 224.105767608437 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.46610199043698" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.9666450108906 10.253481456000003 L 919.1873137748906 10.253481456000003 L 919.1873137748906 50.815047804 L 843.9666450108906 50.815047804 L 843.9666450108906 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.3269793928906" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1494.2024775906514 10.253481456000003 L 1546.439812767005 10.253481456000003 L 1546.439812767005 50.815047804 L 1494.2024775906514 50.815047804 L 1494.2024775906514 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1510.5628119726514" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 224.105767608437 1483.2867218039999 L 284.4264367539067 1483.2867218039999 L 284.4264367539067 1523.848288152 L 224.105767608437 1523.848288152 L 224.105767608437 1483.2867218039999 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.46610199043698" y="1508.769638952" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.9666450108906 1483.2867218039999 L 919.1873137748906 1483.2867218039999 L 919.1873137748906 1523.848288152 L 843.9666450108906 1523.848288152 L 843.9666450108906 1483.2867218039999 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.3269793928906" y="1508.769638952" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1494.2024775906514 1483.2867218039999 L 1546.439812767005 1483.2867218039999 L 1546.439812767005 1523.848288152 L 1494.2024775906514 1523.848288152 L 1494.2024775906514 1483.2867218039999 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1510.5628119726514" y="1508.769638952" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 487.4220954823437 80.97234620399999 L 500.9928797623437 94.54313048399999 L 500.9928797623437 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 487.4220954823437 80.97234620399999 L 487.4220954823437 94.54313048399999 L 500.9928797623437 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 487.88352700703126 168.42851156399996 L 1261.69964749875 168.42851156399996 L 1275.27043177875 181.99929584399996 L 1275.27043177875 278.502650724 L 487.88352700703126 278.502650724 L 487.88352700703126 168.42851156399996 M 1261.69964749875 168.42851156399996 L 1261.69964749875 181.99929584399996 L 1275.27043177875 181.99929584399996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="189.53862044399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the subject of the public client certificate (OU and CN attributes) is used as a global client identifier,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_fhir-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1268.8943706494142 301.120624524 L 1758.1771354282423 301.120624524 L 1771.7479197082423 314.691408804 L 1771.7479197082423 396.116114484 L 1268.8943706494142 396.116114484 L 1268.8943706494142 301.120624524 M 1758.1771354282423 301.120624524 L 1758.1771354282423 314.691408804 L 1771.7479197082423 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.004479529414" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.004479529414" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.004479529414" y="352.388031804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.004479529414" y="367.46668100399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.004479529414" y="382.5453302039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="899.4200476128907" y="418.734088284" width="492.54025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="433.81273748399997" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="448.89138668399994" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="463.9700358839999" width="615.6235703459375" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="479.0486850839999" width="246.54025735765626" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="494.12733428399986" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="509.20598348399983" width="470.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="524.2846326839998" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="539.3632818839998" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="899.4200476128907" y="554.4419310839997" width="236.40692605882813" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="432.304872564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="447.38352176399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="462.46217096399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="477.5408201639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token, e.g. urn:domain:mta:clientid</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="492.6194693639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="507.69811856399986" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="522.7767677639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="537.8554169639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="552.9340661639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928907" y="568.0127153639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 574.044175044 L 941.8915761928906 574.044175044 L 941.8915761928906 593.646419004 L 893.9917339008906 593.646419004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,593.646419004) translate(-881.5769793928906,-593.646419004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.1425203928907 587.363648504 L 881.5769793928906 593.646419004 L 894.1425203928907 599.929189504 Z"/></g></g><g><g><rect fill="white" stroke="none" x="316.5014029529297" y="616.264392804" width="425.6902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="316.5014029529297" y="631.3430420039999" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="316.5014029529297" y="646.4216912039999" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="316.5014029529297" y="661.5003404039999" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="316.5014029529297" y="676.5789896039998" width="200.74025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="316.5014029529297" y="691.6576388039998" width="470.9902695646875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="629.835177084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Send an HTTP request to the STS endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="644.9138262839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="659.9924754839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="675.0711246839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="690.1497738839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.7632003329297" y="705.2284230839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 711.2598827639999 L 266.68085668917183 711.2598827639999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,711.2598827639999) translate(-254.26610218117185,-711.2598827639999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 704.977112264 L 254.26610218117185 711.2598827639999 L 266.83164318117184 717.5426532639999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="733.877856564" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="748.956505764" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="764.035154964" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="779.1138041639999" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="747.448640844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="762.527290044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="777.605939244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="792.6845884439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 798.7160481239999 L 314.58069898117185 798.7160481239999 L 314.58069898117185 818.318292084 L 266.68085668917183 818.318292084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,818.318292084) translate(-254.26610218117185,-818.318292084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 812.035521584 L 254.26610218117185 818.318292084 L 266.83164318117184 824.6010625839999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="840.9362658839999" width="477.64026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="856.0149150839999" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="871.0935642839999" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="886.1722134839998" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="901.2508626839998" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="916.3295118839998" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="931.4081610839997" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="946.4868102839997" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="961.5654594839997" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="976.6441086839997" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="991.7227578839996" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="1006.8014070839996" width="604.1902817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="1021.8800562839996" width="601.9069565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="1036.9587054839997" width="551.9236191740625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="854.5070501639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="869.5856993639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="884.6643485639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="899.7429977639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="914.8216469639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="929.9002961639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="944.9789453639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="960.0575945639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="975.1362437639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="990.2148929639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="1005.2935421639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="1020.3721913639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="1035.4508405639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _fhir-client.sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="1050.5294897639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 1056.560949444 L 314.58069898117185 1056.560949444 L 314.58069898117185 1076.163193404 L 266.68085668917183 1076.163193404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,1076.163193404) translate(-254.26610218117185,-1076.163193404)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 1069.880422904 L 254.26610218117185 1076.163193404 L 266.83164318117184 1082.4459639039999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="341.6764060046875" y="1098.781167204" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="1113.859816404" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="1128.938465604" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="1144.017114804" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="1159.0957640039999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1112.351951484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1127.430600684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1142.509249884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1157.587899084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1172.6665482839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 1178.698007964 L 869.1622248848906 1178.698007964" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,1178.698007964) translate(-881.5769793928906,-1178.698007964)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.0114383928906 1172.415237464 L 881.5769793928906 1178.698007964 L 869.0114383928906 1184.980778464 Z"/></g></g><g><g><rect fill="white" stroke="none" x="971.8955931529297" y="1201.315981764" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="974.1573905329296" y="1214.886766044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 1220.918225724 L 1507.9063906708282 1220.918225724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1520.3211451788281,1220.918225724) translate(-1520.3211451788281,-1220.918225724)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1507.7556041788282 1214.635455224 L 1520.3211451788281 1220.918225724 L 1507.7556041788282 1227.200996224 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1243.5361995239998" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1258.6148487239998" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1273.6934979239998" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1288.7721471239997" width="414.22360696703123" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1303.8507963239997" width="494.3069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1318.9294455239997" width="38.20692911058594" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1334.0080947239996" width="371.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1538.1642133988282" y="1349.0867439239996" width="319.1902512541406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1257.1069838039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1272.1856330039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1287.2642822039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1302.3429314039997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. use WebFinger to locate the STS for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1317.4215806039997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        its identifier and verify that the STS matches the token issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1332.5002298039997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1347.5788790039996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1540.4260107788282" y="1362.6575282039996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        and the STS host domain must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1520.3211451788281 1368.688987884 L 1580.6357419788283 1368.688987884 L 1580.6357419788283 1388.2912318439999 L 1532.7358996868281 1388.2912318439999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1520.3211451788281,1388.2912318439999) translate(-1520.3211451788281,-1388.2912318439999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1532.886686178828 1382.008461344 L 1520.3211451788281 1388.2912318439999 L 1532.886686178828 1394.5740023439998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="960.5122618541016" y="1410.909205644" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="962.7740592341015" y="1424.479989924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1520.3211451788281 1430.5114496039998 L 893.9917339008906 1430.5114496039998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,1430.5114496039998) translate(-881.5769793928906,-1430.5114496039998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.1425203928907 1424.2286791039999 L 881.5769793928906 1430.5114496039998 L 894.1425203928907 1436.7942201039998 Z"/></g></g></g></g></svg>