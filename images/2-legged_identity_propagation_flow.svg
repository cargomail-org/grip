<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1421" height="1347"><desc>participant%20%22AS%22%20as%20AS%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RS%0A%0Abottomparticipants%0A%0Aentryspacing%201.0%0Anote%20over%20AS%3AAS%5Cn%E2%80%A2%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20self-signed%20or%20CA-signed%20certificate%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20Client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20Client's%20public%20key%20hash%20is%20published%20on%20the%20client%20domain%20using%20DNS%20TXT%20record%2C%5Cn%20%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io.%20IN%20TXT%20%20%22v%3Dgrip1%3B%20h%3Dsha256%3B%20p%3Dd2abde240d7cd3ee6b%20...%20e971%22%0Anote%20over%20RS%3ARS%3A%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20AS%20issuer%20discovery%20mechanism%0AClient-%3EClient%3A1.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20certificate-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20AS%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20the%20cryptographic%20signature%20of%20the%20data%20being%20transmitted%0AAS%3C-Client%3A2.%20Send%20an%20HTTP%20request%20to%20the%20AS%20STS%20token%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0AAS-%3EAS%3A3.%20Authorization%20decision%3A%5Cn%20%20%20%201.%20authenticate%20the%20client%20using%20the%20specified%20credentials%5Cn%20%20%20%202.%20evaluate%20the%20resource%20parameter%5Cn%20%20%20%203.%20verify%20the%20subject_token%20signature%20using%20the%20Client's%20certificate%20public%20key%5Cn%20%20%20%204.%20validate%20the%20subject_token%20proof-of-possession%5Cn%20%20%20%205.%20evaluate%20the%20subject_token%20claims%5Cn%20%20%20%206.%20(optional)%20evaluate%20embedded%20tokens%0A%0AAS-%3EAS%3A4.%20AS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%0AClient%3C-AS%3A5.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3EClient%3A6.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20DNS-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20jwk%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20jwks%20holds%20a%20Client's%20certificate%20public%20key%20in%20the%20JWK%20Set%20format%5Cn%20%20%20%20%20%20(alternatively%20provide%20JWK%20Set%20by%20URI%20using%20jwks_uri%20claim)%5Cn%20%20%20%20%E2%80%A2%20tokens%20holds%20an%20embedded%20JWT%20from%20the%20previous%20step%5Cn%20%20%20%20%20%20and%20optionally%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20the%20cryptographic%20signature%20of%20the%20data%20being%20transmitted%0A%0AClient-%3ERS%3A7.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARS-%3ERS%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20the%20client%20is%20authenticated%20via%20the%20DNS%5Cn%20%20%20%20%20%20%20using%20the%20TXT%20record%20and%20CN%20from%20the%20public%20Client's%20certificate%5Cn%20%20%20%202.%20verify%20token%20signature%5Cn%20%20%20%203.%20validate%20proof-of-possession%5Cn%20%20%20%204.%20evaluate%20embedded%20token%20from%20the%20AS%5Cn%20%20%20%205.%20(optional)%20evaluate%20embedded%20tokens%20from%20the%20previous%20hops%5Cn%20%20%20%206.%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20and%20the%20CN's%20domain%20part%20from%20the%20public%20Client's%20certificate%20must%20match%0ARS-%3EClient%3A9.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1421" height="1347"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 204.94962842351563 33.876698536 L 204.94962842351563 1311.5409074160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 590.2124320627083 33.876698536 L 590.2124320627083 1311.5409074160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1042.291886092526 33.876698536 L 1042.291886092526 1311.5409074160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 187.89273874014822 6.835654304000002 L 222.00651810688308 6.835654304000002 L 222.00651810688308 33.876698536 L 187.89273874014822 33.876698536 L 187.89273874014822 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="198.7996283281482" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 565.8138756808851 6.835654304000002 L 614.6109884445316 6.835654304000002 L 614.6109884445316 33.876698536 L 565.8138756808851 33.876698536 L 565.8138756808851 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="576.7207652688851" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1025.184996695261 6.835654304000002 L 1059.3987754897912 6.835654304000002 L 1059.3987754897912 33.876698536 L 1025.184996695261 33.876698536 L 1025.184996695261 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1036.091886283261" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 187.89273874014822 1311.5409074160002 L 222.00651810688308 1311.5409074160002 L 222.00651810688308 1338.5819516480003 L 187.89273874014822 1338.5819516480003 L 187.89273874014822 1311.5409074160002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="198.7996283281482" y="1328.529518848" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 565.8138756808851 1311.5409074160002 L 614.6109884445316 1311.5409074160002 L 614.6109884445316 1338.5819516480003 L 565.8138756808851 1338.5819516480003 L 565.8138756808851 1311.5409074160002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="576.7207652688851" y="1328.529518848" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1025.184996695261 1311.5409074160002 L 1059.3987754897912 1311.5409074160002 L 1059.3987754897912 1338.5819516480003 L 1025.184996695261 1338.5819516480003 L 1025.184996695261 1311.5409074160002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1036.091886283261" y="1328.529518848" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.0262164 53.981564135999996 L 395.82585092703124 53.981564135999996 L 404.87304044703126 63.02875365599999 L 404.87304044703126 107.259457976 L 5.0262164 107.259457976 L 5.0262164 53.981564135999996 M 395.82585092703124 53.981564135999996 L 395.82585092703124 63.02875365599999 L 404.87304044703126 63.02875365599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="88.15983565600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="98.21226845600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 333.24736354505205 122.33810717600001 L 838.1303110603646 122.33810717600001 L 847.1775005803646 131.385296696 L 847.1775005803646 225.87816501600003 L 333.24736354505205 225.87816501600003 L 333.24736354505205 122.33810717600001 M 838.1303110603646 122.33810717600001 L 838.1303110603646 131.385296696 L 847.1775005803646 131.385296696" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="136.411513096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="146.46394589599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="156.51637869599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="166.56881149599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses self-signed or CA-signed certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="176.62124429599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public Client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="186.67367709599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="196.72610989599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="206.77854269599993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the Client's public key hash is published on the client domain using DNS TXT record,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="347.3207694650521" y="216.83097549599992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., _smtp-client.foo.127.0.0.1.nip.io. IN TXT  "v=grip1; h=sha256; p=d2abde240d7cd3ee6b ... e971"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 842.3684740690104 240.956814216 L 1233.1681085960415 240.956814216 L 1242.2152981160416 250.004003736 L 1242.2152981160416 304.287140856 L 842.3684740690104 304.287140856 L 842.3684740690104 240.956814216 M 1233.1681085960415 240.956814216 L 1233.1681085960415 250.004003736 L 1242.2152981160416 250.004003736" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.4418799890104" y="255.03022013600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.4418799890104" y="265.08265293600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.4418799890104" y="275.13508573600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.4418799890104" y="285.1875185360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.4418799890104" y="295.2399513360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="602.1078108760416" y="319.365790056" width="329.4824046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="329.418222856" width="294.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="339.470655656" width="235.29907029410157" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="349.52308845600004" width="357.6323985411719" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="359.57552125600006" width="192.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="369.6279540560001" width="151.56573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="379.6803868560001" width="213.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="389.7328196560001" width="291.6990489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="399.78525245600014" width="298.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="409.83768525600016" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="419.8901180560002" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="429.9425508560002" width="150.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="439.9949836560002" width="324.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="450.04741645600024" width="436.6657237364844" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="328.412979576" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="338.465412376" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    certificate-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="348.51784517600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="358.57027797600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="368.6227107760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="378.6751435760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="388.7275763760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="398.78000917600014" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="408.83244197600015" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="418.8848747760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="428.9373075760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="438.9897403760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="449.04217317600023" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="459.09460597600025" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains the cryptographic signature of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 590.2124320627083 463.115579096 L 630.4221632627083 463.115579096 L 630.4221632627083 476.183741736 L 598.4889350680417 476.183741736" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(590.2124320627083,476.183741736) translate(-590.2124320627083,-476.183741736)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 598.5894593960417 471.99522806933334 L 590.2124320627083 476.183741736 L 598.5894593960417 480.37225540266667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="237.72315921959634" y="491.26239093600003" width="314.9490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="237.72315921959634" y="501.31482373600005" width="319.71574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="237.72315921959634" y="511.36725653600007" width="148.86573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="237.72315921959634" y="521.419689336" width="312.7324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="237.72315921959634" y="531.472122136" width="127.69906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="237.72315921959634" y="541.5245549360001" width="299.43238633414063" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="500.30958045600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Send an HTTP request to the AS STS token endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="510.36201325600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="520.4144460560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="530.4668788560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="540.5193116560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="239.23102413959634" y="550.5717444560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 590.2124320627083 554.592717576 L 213.22613142884896 554.592717576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(204.94962842351563,554.592717576) translate(-204.94962842351563,-554.592717576)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 213.32665575684896 550.4042039093333 L 204.94962842351563 554.592717576 L 213.32665575684896 558.7812312426668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="216.84500723684897" y="569.671366776" width="121.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="579.723799576" width="278.49906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="589.776232376" width="181.08239548941407" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="599.8286651760001" width="369.8490733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="609.8810979760001" width="242.99906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="619.9335307760001" width="186.01572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="629.9859635760001" width="202.13239854117188" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="578.7185562960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="588.7709890960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. authenticate the client using the specified credentials</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="598.8234218960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="608.8758546960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the subject_token signature using the Client's certificate public key</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="618.9282874960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. validate the subject_token proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="628.9807202960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. evaluate the subject_token claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="639.0331530960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. (optional) evaluate embedded tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 204.94962842351563 643.0541262160001 L 245.15935962351563 643.0541262160001 L 245.15935962351563 656.1222888560001 L 213.22613142884896 656.1222888560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(204.94962842351563,656.1222888560001) translate(-204.94962842351563,-656.1222888560001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 213.32665575684896 651.9337751893333 L 204.94962842351563 656.1222888560001 L 213.32665575684896 660.3108025226668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="216.84500723684897" y="671.200938056" width="318.93238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="681.2533708560001" width="165.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="691.3058036560001" width="235.29907029410157" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="701.3582364560001" width="252.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="711.4106692560001" width="284.1657237364844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="721.4631020560001" width="131.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="731.5155348560002" width="210.14906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="741.5679676560002" width="234.2157267882422" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="751.6204004560002" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="761.6728332560002" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="771.7252660560002" width="150.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="781.7776988560003" width="315.53239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="791.8301316560003" width="285.8490733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="801.8825644560003" width="279.08241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="811.9349972560003" width="350.83241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="216.84500723684897" y="821.9874300560003" width="324.64906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="680.2481275760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="690.3005603760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="700.3529931760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="710.4054259760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="720.4578587760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="730.5102915760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="740.5627243760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="750.6151571760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="760.6675899760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="770.7200227760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="780.7724555760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="790.8248883760003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="800.8773211760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="810.9297539760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="820.9821867760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="218.35287215684897" y="831.0346195760004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 204.94962842351563 835.0555926960001 L 245.15935962351563 835.0555926960001 L 245.15935962351563 848.123755336 L 213.22613142884896 848.123755336" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(204.94962842351563,848.123755336) translate(-204.94962842351563,-848.123755336)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 213.32665575684896 843.9352416693333 L 204.94962842351563 848.123755336 L 213.32665575684896 852.3122690026668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="253.7564996736979" y="863.202404536" width="93.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="253.7564996736979" y="873.254837336" width="111.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="253.7564996736979" y="883.307270136" width="287.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="253.7564996736979" y="893.3597029360001" width="98.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="253.7564996736979" y="903.4121357360001" width="94.34906571646485" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="255.2643645936979" y="872.2495940560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="255.2643645936979" y="882.3020268560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="255.2643645936979" y="892.3544596560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="255.2643645936979" y="902.4068924560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="255.2643645936979" y="912.4593252560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 204.94962842351563 916.4802983760001 L 581.935929057375 916.4802983760001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(590.2124320627083,916.4802983760001) translate(-590.2124320627083,-916.4802983760001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 581.835404729375 912.2917847093333 L 590.2124320627083 916.4802983760001 L 581.835404729375 920.6688120426668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="602.1078108760416" y="931.558947576" width="329.4824046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="941.611380376" width="267.39906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="951.6638131760001" width="236.58239548941407" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="961.7162459760001" width="357.6323985411719" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="971.7686787760001" width="192.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="981.8211115760001" width="170.69906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="991.8735443760002" width="213.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1001.9259771760002" width="291.6990489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1011.9784099760002" width="298.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1022.0308427760002" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1032.0832755760002" width="321.28239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1042.1357083760001" width="294.0490550353125" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1052.188141176" width="279.28239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1062.240573976" width="281.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="602.1078108760416" y="1072.2930067759999" width="436.6657237364844" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="940.6061370960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="950.6585698960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    DNS-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="960.7110026960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, jwk, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="970.7634354960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="980.8158682960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="990.8683010960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1000.9207338960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1010.9731666960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1021.0255994960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1031.0780322960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1041.130465096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • jwks holds a Client's certificate public key in the JWK Set format</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1051.182897896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (alternatively provide JWK Set by URI using jwks_uri claim)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1061.235330696" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens holds an embedded JWT from the previous step</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1071.2877634959998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      and optionally an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.6156757960416" y="1081.3401962959997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains the cryptographic signature of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 590.2124320627083 1085.361169416 L 630.4221632627083 1085.361169416 L 630.4221632627083 1098.429332056 L 598.4889350680417 1098.429332056" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(590.2124320627083,1098.429332056) translate(-590.2124320627083,-1098.429332056)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 598.5894593960417 1094.2408183893333 L 590.2124320627083 1098.429332056 L 598.5894593960417 1102.6178457226667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="670.6192941576172" y="1113.507981256" width="291.26572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="672.1271590776172" y="1122.5551707759998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 590.2124320627083 1126.576143896 L 1034.0153830871927 1126.576143896" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(1042.291886092526,1126.576143896) translate(-1042.291886092526,-1126.576143896)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1033.9148587591926 1122.3876302293334 L 1042.291886092526 1126.576143896 L 1033.9148587591926 1130.7646575626668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1141.654793096" width="118.73239701529297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1151.707225896" width="207.33239548941407" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1161.7596586959999" width="318.93238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1171.8120914959998" width="128.98239701529297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1181.8645242959997" width="157.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1191.9169570959996" width="207.4657267882422" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1201.9693898959995" width="313.26572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1212.0218226959994" width="236.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1054.1872649058596" y="1222.0742554959993" width="363.76572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1150.701982616" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1160.7544154159998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. the client is authenticated via the DNS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1170.8068482159997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       using the TXT record and CN from the public Client's certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1180.8592810159996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1190.9117138159995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1200.9641466159994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. evaluate embedded token from the AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1211.0165794159993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. (optional) evaluate embedded tokens from the previous hops</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1221.0690122159992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.6951298258596" y="1231.1214450159991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       and the CN's domain part from the public Client's certificate must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1042.291886092526 1235.142418136 L 1082.5016172925261 1235.142418136 L 1082.5016172925261 1248.2105807760001 L 1050.5683890978594 1248.2105807760001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(1042.291886092526,1248.2105807760001) translate(-1042.291886092526,-1248.2105807760001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1050.6689134258595 1244.0220671093334 L 1042.291886092526 1248.2105807760001 L 1050.6689134258595 1252.3990944426669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="663.3776254564453" y="1263.2892299760001" width="305.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="664.8854903764453" y="1272.336419496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1042.291886092526 1276.3573926160002 L 598.4889350680417 1276.3573926160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(590.2124320627083,1276.3573926160002) translate(-590.2124320627083,-1276.3573926160002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 598.5894593960417 1272.1688789493335 L 590.2124320627083 1276.3573926160002 L 598.5894593960417 1280.545906282667 Z"/></g></g></g></g></svg>