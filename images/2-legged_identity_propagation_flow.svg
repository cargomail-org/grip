<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2112" height="2020"><desc>participant%20%22AS%22%20as%20AS%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RS%0A%0Abottomparticipants%0A%0Aentryspacing%201.0%0Anote%20over%20AS%3AAS%5Cn%E2%80%A2%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20self-signed%20or%20CA-signed%20certificate%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20Client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20Client's%20public%20key%20hash%20is%20published%20on%20the%20client%20domain%20using%20DNS%20TXT%20record%2C%5Cn%20%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io.%20IN%20TXT%20%20%22v%3Dgrip1%3B%20h%3Dsha256%3B%20p%3Dd2abde240d7cd3ee6b%20...%20e971%22%0Anote%20over%20RS%3ARS%3A%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20AS%20issuer%20discovery%20mechanism%0AClient-%3EClient%3A1.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20certificate-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20AS%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20a%20fingerprint%20of%20the%20data%20being%20transmitted%0AAS%3C-Client%3A2.%20Send%20an%20HTTP%20request%20to%20the%20AS%20STS%20token%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0AAS-%3EAS%3A3.%20Authorization%20decision%3A%5Cn%20%20%20%201.%20authenticate%20the%20client%20using%20the%20specified%20credentials%5Cn%20%20%20%202.%20evaluate%20the%20resource%20parameter%5Cn%20%20%20%203.%20verify%20the%20subject_token%20signature%20using%20the%20Client's%20certificate%20public%20key%5Cn%20%20%20%204.%20validate%20the%20subject_token%20proof-of-possession%5Cn%20%20%20%205.%20evaluate%20the%20subject_token%20claims%5Cn%20%20%20%206.%20(optional)%20evaluate%20embedded%20tokens%0A%0AAS-%3EAS%3A4.%20AS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%0AClient%3C-AS%3A5.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3EClient%3A6.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20DNS-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20jwk%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20jwks%20holds%20a%20Client's%20certificate%20public%20key%20in%20the%20JWK%20Set%20format%5Cn%20%20%20%20%20%20(alternatively%20provide%20JWK%20Set%20by%20URI%20using%20jwks_uri%20claim)%5Cn%20%20%20%20%E2%80%A2%20tokens%20holds%20an%20embedded%20JWT%20from%20the%20previous%20step%5Cn%20%20%20%20%20%20and%20optionally%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20a%20fingerprint%20of%20the%20data%20being%20transmitted%0A%0AClient-%3ERS%3A7.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARS-%3ERS%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20the%20client%20is%20authenticated%20via%20the%20DNS%5Cn%20%20%20%20%20%20%20using%20the%20TXT%20record%20and%20CN%20from%20the%20public%20Client's%20certificate%5Cn%20%20%20%202.%20verify%20token%20signature%5Cn%20%20%20%203.%20validate%20proof-of-possession%5Cn%20%20%20%204.%20evaluate%20embedded%20token%20from%20the%20AS%5Cn%20%20%20%205.%20(optional)%20evaluate%20embedded%20tokens%20from%20the%20previous%20hops%5Cn%20%20%20%206.%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20and%20the%20CN's%20domain%20part%20from%20the%20public%20Client's%20certificate%20must%20match%0ARS-%3EClient%3A9.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2112" height="2020"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 320.33275257179685 50.815047804 L 320.33275257179685 1967.311361124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 923.7602679671094 50.815047804 L 923.7602679671094 1967.311361124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1519.0210963507031 50.815047804 L 1519.0210963507031 1967.311361124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 294.3140844114155 10.253481456000003 L 346.35142073217816 10.253481456000003 L 346.35142073217816 50.815047804 L 294.3140844114155 50.815047804 L 294.3140844114155 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.6744187934155" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 886.216601141872 10.253481456000003 L 961.3039347923467 10.253481456000003 L 961.3039347923467 50.815047804 L 886.216601141872 50.815047804 L 886.216601141872 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="902.5769355238721" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1492.9274283810566 10.253481456000003 L 1545.1147643203497 10.253481456000003 L 1545.1147643203497 50.815047804 L 1492.9274283810566 50.815047804 L 1492.9274283810566 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1509.2877627630567" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 294.3140844114155 1967.311361124 L 346.35142073217816 1967.311361124 L 346.35142073217816 2007.8729274720001 L 294.3140844114155 2007.8729274720001 L 294.3140844114155 1967.311361124 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.6744187934155" y="1992.7942782720002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 886.216601141872 1967.311361124 L 961.3039347923467 1967.311361124 L 961.3039347923467 2007.8729274720001 L 886.216601141872 2007.8729274720001 L 886.216601141872 1967.311361124 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="902.5769355238721" y="1992.7942782720002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1492.9274283810566 1967.311361124 L 1545.1147643203497 1967.311361124 L 1545.1147643203497 2007.8729274720001 L 1492.9274283810566 2007.8729274720001 L 1492.9274283810566 1967.311361124 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1509.2877627630567" y="1992.7942782720002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.972346204 L 619.5553962635937 80.972346204 L 633.1261805435937 94.543130484 L 633.1261805435937 160.889186964 L 7.5393246000000005 160.889186964 L 7.5393246000000005 80.972346204 M 619.5553962635937 80.972346204 L 619.5553962635937 94.543130484 L 633.1261805435937 94.543130484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.082455084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.161104284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="147.318402684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 521.3834964894531 183.50716076399996 L 1312.5662551647656 183.50716076399996 L 1326.1370394447656 197.07794504399996 L 1326.1370394447656 338.817247524 L 521.3834964894531 338.817247524 L 521.3834964894531 183.50716076399996 M 1312.5662551647656 183.50716076399996 L 1312.5662551647656 197.07794504399996 L 1326.1370394447656 197.07794504399996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses self-signed or CA-signed certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public Client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="280.01051564399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="295.0891648439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="310.1678140439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the Client's public key hash is published on the client domain using DNS TXT record,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.4936053694531" y="325.24646324399987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., _smtp-client.foo.127.0.0.1.nip.io. IN TXT  "v=grip1; h=sha256; p=d2abde240d7cd3ee6b ... e971"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1206.2276683789064 361.435221324 L 1818.2437400425001 361.435221324 L 1831.8145243225001 375.006005604 L 1831.8145243225001 456.430711284 L 1206.2276683789064 456.430711284 L 1206.2276683789064 361.435221324 M 1818.2437400425001 361.435221324 L 1818.2437400425001 375.006005604 L 1831.8145243225001 375.006005604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3377772589063" y="382.54533020400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3377772589063" y="397.623979404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3377772589063" y="412.702628604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3377772589063" y="427.78127780399996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3377772589063" y="442.8599270039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="941.6033361871094" y="479.048685084" width="516.9236191740625" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="494.12733428399997" width="461.8069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="509.20598348399994" width="369.04025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="524.2846326839999" width="561.0069321623438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="539.3632818839999" width="301.32358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="554.4419310839999" width="237.6902665129297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="569.5205802839998" width="334.29025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="584.5992294839998" width="457.5902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="599.6778786839998" width="468.75693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="614.7565278839998" width="306.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="629.8351770839997" width="537.206944369375" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="644.9138262839997" width="235.75693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="659.9924754839997" width="509.47360696703123" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="675.0711246839996" width="572.1402329435938" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="492.619469364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="507.69811856399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    certificate-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="522.7767677639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="537.8554169639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="552.9340661639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="568.0127153639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="583.0913645639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="598.1700137639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="613.2486629639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="628.3273121639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="643.4059613639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="658.4846105639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="673.5632597639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="688.6419089639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains a fingerprint of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 923.7602679671094 694.673368644 L 984.0748647671094 694.673368644 L 984.0748647671094 714.275612604 L 936.1750224751094 714.275612604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(923.7602679671094,714.275612604) translate(-923.7602679671094,-714.275612604)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 936.3258089671094 707.992842104 L 923.7602679671094 714.275612604 L 936.3258089671094 720.558383104 Z"/></g></g><g><g><rect fill="white" stroke="none" x="371.24304113652346" y="736.893586404" width="494.1902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="371.24304113652346" y="751.9722356039999" width="501.60693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="371.24304113652346" y="767.0508848039999" width="233.37360086351563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="371.24304113652346" y="782.1295340039999" width="490.64026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="371.24304113652346" y="797.2081832039999" width="200.1902665129297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="371.24304113652346" y="812.2868324039998" width="469.75693216234373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="750.464370684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Send an HTTP request to the AS STS token endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="765.5430198839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="780.6216690839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="795.7003182839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="810.7789674839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.5048385165235" y="825.8576166839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 923.7602679671094 831.889076364 L 332.74750707979683 831.889076364" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(320.33275257179685,831.889076364) translate(-320.33275257179685,-831.889076364)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 332.89829357179684 825.606305864 L 320.33275257179685 831.889076364 L 332.89829357179684 838.1718468639999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="338.1758207917968" y="854.5070501639999" width="191.10692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="869.5856993639999" width="436.9069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="884.6643485639999" width="283.97360696703123" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="899.7429977639998" width="580.3069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="914.8216469639998" width="381.2402695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="929.9002961639998" width="291.7402695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="944.9789453639997" width="317.14026346117186" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="868.0778344439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="883.1564836439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. authenticate the client using the specified credentials</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="898.2351328439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="913.3137820439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the subject_token signature using the Client's certificate public key</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="928.3924312439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. validate the subject_token proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="943.4710804439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. evaluate the subject_token claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="958.5497296439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. (optional) evaluate embedded tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 320.33275257179685 964.5811893239999 L 380.64734937179685 964.5811893239999 L 380.64734937179685 984.1834332839999 L 332.74750707979683 984.1834332839999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(320.33275257179685,984.1834332839999) translate(-320.33275257179685,-984.1834332839999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 332.89829357179684 977.9006627839999 L 320.33275257179685 984.1834332839999 L 332.89829357179684 990.4662037839998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1006.801407084" width="500.3736008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1021.8800562839999" width="259.9902543058984" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1036.958705484" width="369.04025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1052.0373546839999" width="395.9069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1067.1160038839998" width="445.82358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1082.1946530839998" width="206.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1097.2733022839998" width="329.64026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1112.3519514839998" width="367.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1127.4306006839997" width="306.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1142.5092498839997" width="537.206944369375" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1157.5878990839997" width="235.75693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1172.6665482839996" width="495.07358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1187.7451974839996" width="448.42358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1202.8238466839996" width="437.82358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1217.9024958839996" width="550.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="338.1758207917968" y="1232.9811450839995" width="509.47360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1020.372191364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1035.450840564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1050.529489764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1065.6081389639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1080.6867881639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1095.7654373639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1110.8440865639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1125.9227357639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1141.0013849639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1156.0800341639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1171.1586833639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1186.2373325639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1201.3159817639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1216.3946309639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1231.4732801639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="340.4376181717968" y="1246.5519293639995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 320.33275257179685 1252.5833890440001 L 380.64734937179685 1252.5833890440001 L 380.64734937179685 1272.185633004 L 332.74750707979683 1272.185633004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(320.33275257179685,1272.185633004) translate(-320.33275257179685,-1272.185633004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 332.89829357179684 1265.902862504 L 320.33275257179685 1272.185633004 L 332.89829357179684 1278.468403504 Z"/></g></g><g><g><rect fill="white" stroke="none" x="396.38471899296877" y="1294.803606804" width="145.95692911058595" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="396.38471899296877" y="1309.882256004" width="175.37360086351563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="396.38471899296877" y="1324.960905204" width="451.32358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="396.38471899296877" y="1340.039554404" width="154.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="396.38471899296877" y="1355.118203604" width="147.9402665129297" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.6465163729688" y="1308.374391084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.6465163729688" y="1323.453040284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.6465163729688" y="1338.531689484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.6465163729688" y="1353.610338684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.6465163729688" y="1368.688987884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 320.33275257179685 1374.720447564 L 911.3455134591094 1374.720447564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(923.7602679671094,1374.720447564) translate(-923.7602679671094,-1374.720447564)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 911.1947269671093 1368.4376770640001 L 923.7602679671094 1374.720447564 L 911.1947269671093 1381.003218064 Z"/></g></g><g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1397.338421364" width="516.9236191740625" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1412.417070564" width="419.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1427.495719764" width="371.07358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1442.5743689639999" width="561.0069321623438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1457.6530181639998" width="301.32358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1472.7316673639998" width="267.6902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1487.8103165639998" width="334.29025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1502.8889657639997" width="457.5902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1517.9676149639997" width="468.75693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1533.0462641639997" width="306.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1548.1249133639997" width="504.07358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1563.2035625639996" width="461.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1578.2822117639996" width="438.20691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1593.3608609639996" width="441.9069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="941.6033361871094" y="1608.4395101639996" width="572.1402329435938" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1410.909205644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1425.987854844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    DNS-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1441.0665040439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, jwk, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1456.1451532439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1471.2238024439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1486.3024516439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1501.3811008439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1516.4597500439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1531.5383992439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1546.6170484439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1561.6956976439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • jwks holds a Client's certificate public key in the JWK Set format</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1576.7743468439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (alternatively provide JWK Set by URI using jwks_uri claim)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1591.8529960439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens holds an embedded JWT from the previous step</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1606.9316452439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      and optionally an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.8651335671094" y="1622.0102944439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains a fingerprint of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 923.7602679671094 1628.0417541240001 L 984.0748647671094 1628.0417541240001 L 984.0748647671094 1647.643998084 L 936.1750224751094 1647.643998084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(923.7602679671094,1647.643998084) translate(-923.7602679671094,-1647.643998084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 936.3258089671094 1641.361227584 L 923.7602679671094 1647.643998084 L 936.3258089671094 1653.926768584 Z"/></g></g><g><g><rect fill="white" stroke="none" x="992.9205565318359" y="1670.261971884" width="456.9402512541406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.1823539118359" y="1683.832756164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 923.7602679671094 1689.864215844 L 1506.6063418427032 1689.864215844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1519.0210963507031,1689.864215844) translate(-1519.0210963507031,-1689.864215844)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1506.4555553507032 1683.581445344 L 1519.0210963507031 1689.864215844 L 1506.4555553507032 1696.146986344 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1712.482189644" width="186.17358865648438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1727.560838844" width="325.1902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1742.639488044" width="500.3069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1757.718137244" width="202.24025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1772.796786444" width="246.62360086351563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1787.875435644" width="325.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1802.954084844" width="491.5902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1818.0327340439999" width="370.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1536.8641645707032" y="1833.1113832439999" width="570.6736191740625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1726.052973924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1741.131623124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. the client is authenticated via the DNS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1756.210272324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       using the TXT record and CN from the public Client's certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1771.288921524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1786.367570724" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1801.446219924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. evaluate embedded token from the AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1816.524869124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. (optional) evaluate embedded tokens from the previous hops</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1831.6035183239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1539.1259619507032" y="1846.6821675239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       and the CN's domain part from the public Client's certificate must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1519.0210963507031 1852.7136272040002 L 1579.3356931507033 1852.7136272040002 L 1579.3356931507033 1872.315871164 L 1531.4358508587031 1872.315871164" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1519.0210963507031,1872.315871164) translate(-1519.0210963507031,-1872.315871164)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1531.586637350703 1866.0331006640001 L 1519.0210963507031 1872.315871164 L 1531.586637350703 1878.598641664 Z"/></g></g><g><g><rect fill="white" stroke="none" x="981.5455565318359" y="1894.9338449640002" width="479.6902512541406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="983.8073539118359" y="1908.5046292440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1519.0210963507031 1914.536088924 L 936.1750224751094 1914.536088924" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(923.7602679671094,1914.536088924) translate(-923.7602679671094,-1914.536088924)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 936.3258089671094 1908.253318424 L 923.7602679671094 1914.536088924 L 936.3258089671094 1920.818859424 Z"/></g></g></g></g></svg>