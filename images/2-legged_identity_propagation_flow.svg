<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1733" height="1852"><desc>participant%20%22AS%22%20as%20AS%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RS%0A%0Abottomparticipants%0A%0Aentryspacing%201.0%0Anote%20over%20AS%3AAS%5Cn%E2%80%A2%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20self-signed%20or%20CA-signed%20certificate%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20Client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20Client's%20public%20key%20hash%20is%20published%20on%20the%20client%20domain%20using%20DNS%20TXT%20record%2C%5Cn%20%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io.%20IN%20TXT%20%20%22v%3Dgrip1%3B%20h%3Dsha256%3B%20p%3Dd2abde240d7cd3ee6b%20...%20e971%22%0Anote%20over%20RS%3ARS%3A%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20AS%20issuer%20discovery%20mechanism%0AClient-%3EClient%3A1.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20certificate-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20AS%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20the%20digest%20of%20the%20data%20being%20transmitted%0AAS%3C-Client%3A2.%20Send%20an%20HTTP%20request%20to%20the%20AS%20STS%20token%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0AAS-%3EAS%3A3.%20Authorization%20decision%3A%5Cn%20%20%20%201.%20authenticate%20the%20client%20using%20the%20specified%20credentials%5Cn%20%20%20%202.%20evaluate%20the%20resource%20parameter%5Cn%20%20%20%203.%20verify%20the%20subject_token%20signature%20using%20the%20Client's%20certificate%20public%20key%5Cn%20%20%20%204.%20validate%20the%20subject_token%20proof-of-possession%5Cn%20%20%20%205.%20evaluate%20the%20subject_token%20claims%5Cn%20%20%20%206.%20(optional)%20evaluate%20embedded%20tokens%0A%0AAS-%3EAS%3A4.%20AS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%5Cn%20%20%20%20%E2%80%A2%20tokens%20(optional)%20holds%20an%20embedded%20JWT%20from%20the%20previous%20hop%0AClient%3C-AS%3A5.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3EClient%3A6.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20DNS-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20jwk%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20jwks%20holds%20a%20Client's%20certificate%20public%20key%20in%20the%20JWK%20Set%20format%5Cn%20%20%20%20%20%20(alternatively%20provide%20JWK%20Set%20by%20URI%20using%20jwks_uri%20claim)%5Cn%20%20%20%20%E2%80%A2%20tokens%20holds%20an%20embedded%20JWT%20from%20the%20previous%20step%5Cn%20%20%20%20%20%20and%20optionally%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20the%20digest%20of%20the%20data%20being%20transmitted%0A%0AClient-%3ERS%3A7.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARS-%3ERS%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20the%20client%20is%20authenticated%20via%20the%20DNS%5Cn%20%20%20%20%20%20%20using%20the%20TXT%20record%20and%20CN%20from%20the%20public%20Client's%20certificate%5Cn%20%20%20%202.%20verify%20token%20signature%5Cn%20%20%20%203.%20validate%20proof-of-possession%5Cn%20%20%20%204.%20evaluate%20embedded%20token%20from%20the%20AS%5Cn%20%20%20%205.%20(optional)%20evaluate%20embedded%20tokens%20from%20the%20previous%20hops%5Cn%20%20%20%206.%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20and%20the%20CN's%20domain%20part%20from%20the%20public%20Client's%20certificate%20must%20match%0ARS-%3EClient%3A9.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1733" height="1852"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 46.580460486999996 L 265.3619867935156 1803.3687476970001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 762.6858318791926 46.580460486999996 L 762.6858318791926 1803.3687476970001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.276339562526 46.580460486999996 L 1244.276339562526 1803.3687476970001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 242.44834710229466 9.399024668000001 L 288.27562648473656 9.399024668000001 L 288.27562648473656 46.580460486999996 L 242.44834710229466 46.580460486999996 L 242.44834710229466 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.44532028579465" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 730.3221919018694 9.399024668000001 L 795.0494718565159 9.399024668000001 L 795.0494718565159 46.580460486999996 L 730.3221919018694 46.580460486999996 L 730.3221919018694 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.3191650853694" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1221.3043664743934 9.399024668000001 L 1267.2483126506586 9.399024668000001 L 1267.2483126506586 46.580460486999996 L 1221.3043664743934 46.580460486999996 L 1221.3043664743934 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1236.3013396578933" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 242.44834710229466 1803.3687476970001 L 288.27562648473656 1803.3687476970001 L 288.27562648473656 1840.550183516 L 242.44834710229466 1840.550183516 L 242.44834710229466 1803.3687476970001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.44532028579465" y="1826.7280884160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 730.3221919018694 1803.3687476970001 L 795.0494718565159 1803.3687476970001 L 795.0494718565159 1840.550183516 L 730.3221919018694 1840.550183516 L 730.3221919018694 1803.3687476970001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.3191650853694" y="1826.7280884160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1221.3043664743934 1803.3687476970001 L 1267.2483126506586 1803.3687476970001 L 1267.2483126506586 1840.550183516 L 1221.3043664743934 1840.550183516 L 1221.3043664743934 1803.3687476970001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1236.3013396578933" y="1826.7280884160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 6.91104755 74.224650687 L 511.37304044703126 74.224650687 L 523.8129260370313 86.664536277 L 523.8129260370313 147.481754717 L 6.91104755 147.481754717 L 6.91104755 74.224650687 M 511.37304044703126 74.224650687 L 511.37304044703126 86.664536277 L 523.8129260370313 86.664536277" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="93.575583827" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="107.397678927" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="121.219774027" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="135.041869127" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 430.8265674403645 168.214897367 L 1082.105210728021 168.214897367 L 1094.5450963180208 180.65478295699998 L 1094.5450963180208 310.582476897 L 430.8265674403645 310.582476897 L 430.8265674403645 168.214897367 M 1082.105210728021 168.214897367 L 1082.105210728021 180.65478295699998 L 1094.5450963180208 180.65478295699998" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="187.56583050700002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="201.38792560700003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="215.21002070700004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="229.03211580700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses self-signed or CA-signed certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="242.85421090700007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public Client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="256.67630600700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="270.49840110700006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="284.3204962070001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the Client's public key hash is published on the client domain using DNS TXT record,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="450.1775005803645" y="298.1425913070001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., _smtp-client.foo.127.0.0.1.nip.io. IN TXT  "v=grip1; h=sha256; p=d2abde240d7cd3ee6b ... e971"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 985.8254003190103 331.315619547 L 1490.2873932160417 331.315619547 L 1502.7272788060416 343.755505137 L 1502.7272788060416 418.394818677 L 985.8254003190103 418.394818677 L 985.8254003190103 331.315619547 M 1490.2873932160417 331.315619547 L 1490.2873932160417 343.755505137 L 1502.7272788060416 343.755505137" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1005.1763334590103" y="350.666552687" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1005.1763334590103" y="364.488647787" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1005.1763334590103" y="378.310742887" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1005.1763334590103" y="392.132837987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1005.1763334590103" y="405.95493308700003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="779.041977747526" y="439.12796132700004" width="424.19661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="452.95005642700005" width="378.9966346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="466.77215152700006" width="302.89662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="480.5942466270001" width="460.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="494.4163417270001" width="247.4799567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="508.2384368270001" width="195.29662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="522.060531927" width="274.44661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="535.882627027" width="375.6133033346875" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="549.704722127" width="384.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="563.5268172269999" width="251.91329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="577.3489123269999" width="440.84664073703124" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="591.1710074269998" width="193.7299567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="604.9931025269998" width="418.0632850241406" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="618.8151976269997" width="455.37996593234374" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="451.56784691700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="465.38994201700007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    certificate-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="479.2120371170001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="493.0341322170001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="506.8562273170001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="520.6783224170001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="534.5004175170001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="548.322512617" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="562.144607717" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="575.9667028169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="589.7887979169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="603.6108930169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="617.4329881169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="631.2550832169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains the digest of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 762.6858318791926 636.7839212570001 L 817.9742122791927 636.7839212570001 L 817.9742122791927 654.7526448870001 L 774.0660235115259 654.7526448870001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(762.6858318791926,654.7526448870001) translate(-762.6858318791926,-654.7526448870001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 774.2042444625259 648.9934385953334 L 762.6858318791926 654.7526448870001 L 774.2042444625259 660.5118511786668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="308.23393552545565" y="675.4857875370001" width="405.4633094382031" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="308.23393552545565" y="689.307882637" width="411.57994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="308.23393552545565" y="703.129977737" width="191.76329723117186" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="308.23393552545565" y="716.952072837" width="402.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="308.23393552545565" y="730.7741679369999" width="164.57996288058592" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="308.23393552545565" y="744.5962630369999" width="385.5299598288281" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="687.925673127" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Send an HTTP request to the AS STS token endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="701.7477682269999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="715.5698633269999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="729.3919584269998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="743.2140535269998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="310.30724979045567" y="757.0361486269998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 762.6858318791926 762.5649866670001 L 276.7421784258489 762.5649866670001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,762.5649866670001) translate(-265.3619867935156,-762.5649866670001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 756.8057803753334 L 265.3619867935156 762.5649866670001 L 276.8803993768489 768.3241929586668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="281.71813266184887" y="783.2981293170001" width="157.11328807589842" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="797.120224417" width="358.5632850241406" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="810.942319517" width="233.2466346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="824.7644146169999" width="476.12996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="838.5865097169999" width="312.9966346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="852.4086048169999" width="239.59662547824217" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="866.2306999169998" width="260.4299537253125" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="795.738014907" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="809.5601100069999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. authenticate the client using the specified credentials</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="823.3822051069999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="837.2043002069998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the subject_token signature using the Client's certificate public key</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="851.0263953069998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. validate the subject_token proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="864.8484904069998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. evaluate the subject_token claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="878.6705855069997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. (optional) evaluate embedded tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 884.199423547 L 320.6503671935156 884.199423547 L 320.6503671935156 902.168147177 L 276.7421784258489 902.168147177" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,902.168147177) translate(-265.3619867935156,-902.168147177)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 896.4089408853333 L 265.3619867935156 902.168147177 L 276.8803993768489 907.9273534686668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="281.71813266184887" y="922.901289827" width="410.62996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="936.723384927" width="213.54662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="950.5454800269999" width="302.89662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="964.3675751269999" width="324.9966346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="978.1896702269999" width="365.89662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="992.0117653269998" width="169.59662547824217" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1005.8338604269998" width="270.62996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1019.6559555269997" width="301.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1033.4780506269997" width="251.91329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1047.3001457269997" width="440.84664073703124" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1061.1222408269998" width="193.7299567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1074.9443359269999" width="406.29662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1088.766431027" width="368.07994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1102.588526127" width="359.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1116.410621227" width="451.7133094382031" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="1130.2327163270002" width="418.0632850241406" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="935.3411754169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="949.1632705169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="962.9853656169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="976.8074607169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="990.6295558169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1004.4516509169997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1018.2737460169997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1032.0958411169997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1045.9179362169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1059.7400313169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1073.562126417" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1087.384221517" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1101.206316617" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1115.0284117170002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1128.8505068170002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="1142.6726019170003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens (optional) holds an embedded JWT from the previous hop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 1148.2014399570003 L 320.6503671935156 1148.2014399570003 L 320.6503671935156 1166.1701635870002 L 276.7421784258489 1166.1701635870002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,1166.1701635870002) translate(-265.3619867935156,-1166.1701635870002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 1160.4109572953334 L 265.3619867935156 1166.1701635870002 L 276.8803993768489 1171.9293698786669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="328.8339263701822" y="1186.9033062370002" width="120.07996288058594" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="328.8339263701822" y="1200.7254013370002" width="144.21329417941405" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="328.8339263701822" y="1214.5474964370003" width="370.37996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="328.8339263701822" y="1228.3695915370004" width="127.44663158175781" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="328.8339263701822" y="1242.1916866370004" width="121.66329875705078" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.90724063518223" y="1199.3431918270003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.90724063518223" y="1213.1652869270004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.90724063518223" y="1226.9873820270004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.90724063518223" y="1240.8094771270005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.90724063518223" y="1254.6315722270006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 1260.160410267 L 751.3056402468593 1260.160410267" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(762.6858318791926,1260.160410267) translate(-762.6858318791926,-1260.160410267)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 751.1674192958593 1254.4012039753334 L 762.6858318791926 1260.160410267 L 751.1674192958593 1265.9196165586668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="779.041977747526" y="1280.893552917" width="424.19661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1294.7156480170001" width="344.2799598288281" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1308.5377431170002" width="304.57994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1322.3598382170003" width="460.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1336.1819333170004" width="247.4799567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1350.0040284170004" width="219.87996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1363.8261235170005" width="274.44661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1377.6482186170006" width="375.6133033346875" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1391.4703137170006" width="384.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1405.2924088170007" width="251.91329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1419.1145039170008" width="413.6799537253125" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1432.9365990170008" width="378.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1446.758694117001" width="359.62996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1460.580789217001" width="362.66329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="779.041977747526" y="1474.402884317001" width="455.37996593234374" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1293.3334385070002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1307.1555336070003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    DNS-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1320.9776287070003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, jwk, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1334.7997238070004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1348.6218189070005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1362.4439140070006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1376.2660091070006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1390.0881042070007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1403.9101993070008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1417.7322944070008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1431.554389507001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • jwks holds a Client's certificate public key in the JWK Set format</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1445.376484607001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (alternatively provide JWK Set by URI using jwks_uri claim)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1459.198579707001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens holds an embedded JWT from the previous step</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1473.0206748070011" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      and optionally an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.115292012526" y="1486.8427699070012" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains the digest of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 762.6858318791926 1492.371607947 L 817.9742122791927 1492.371607947 L 817.9742122791927 1510.3403315770001 L 774.0660235115259 1510.3403315770001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(762.6858318791926,1510.3403315770001) translate(-762.6858318791926,-1510.3403315770001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 774.2042444625259 1504.5811252853334 L 762.6858318791926 1510.3403315770001 L 774.2042444625259 1516.0995378686669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="816.0077775593749" y="1531.0734742270001" width="374.94661632296874" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="818.0810918243749" y="1543.5133598170003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 762.6858318791926 1549.0421978570002 L 1232.8961479301925 1549.0421978570002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(1244.276339562526,1549.0421978570002) translate(-1244.276339562526,-1549.0421978570002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1232.7579269791925 1543.2829915653335 L 1244.276339562526 1549.0421978570002 L 1232.7579269791925 1554.801404148667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1569.7753405070002" width="153.06330028292967" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1583.5974356070003" width="267.01329723117186" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1597.4195307070004" width="410.59664073703124" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1611.2416258070004" width="166.2299567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1625.0637209070005" width="202.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1638.8858160070006" width="267.2466346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1652.7079111070007" width="403.41329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1666.5300062070007" width="304.04662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1260.6324854308593" y="1680.3521013070008" width="468.2466346335156" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1582.2152260970004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1596.0373211970004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. the client is authenticated via the DNS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1609.8594162970005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       using the TXT record and CN from the public Client's certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1623.6815113970006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1637.5036064970006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1651.3257015970007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. evaluate embedded token from the AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1665.1477966970008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. (optional) evaluate embedded tokens from the previous hops</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1678.9698917970009" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1262.7057996958592" y="1692.791986897001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       and the CN's domain part from the public Client's certificate must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.276339562526 1698.320824937 L 1299.564719962526 1698.320824937 L 1299.564719962526 1716.289548567 L 1255.6565311948593 1716.289548567" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(1244.276339562526,1716.289548567) translate(-1244.276339562526,-1716.289548567)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1255.7947521458593 1710.5303422753334 L 1244.276339562526 1716.289548567 L 1255.7947521458593 1722.0487548586668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="806.6827653523436" y="1737.022691217" width="393.59664073703124" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="808.7560796173436" y="1749.4625768070002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.276339562526 1754.9914148470002 L 774.0660235115259 1754.9914148470002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(762.6858318791926,1754.9914148470002) translate(-762.6858318791926,-1754.9914148470002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 774.2042444625259 1749.2322085553335 L 762.6858318791926 1754.9914148470002 L 774.2042444625259 1760.750621138667 Z"/></g></g></g></g></svg>