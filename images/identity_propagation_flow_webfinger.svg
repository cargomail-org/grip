<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1935" height="1369"><desc>participant%20%22IdP%2FSTS%22%20as%20STS%0Aparticipant%20%22Propagation%20Proxy%20(RS%20%2B%20Client)%22%20as%20PP%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3AIdP%2FSTS%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20PP%3APropagation%20Proxy%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%2C%5Cn%20%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20e.g.%2C%20OU%3D_fhir-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FSTS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20hash%20of%20the%20client's%20public%20key%20is%20published%20on%20the%20client%20domain%20(usually%20identical%20to%20the%20IdP%20host%20domain)%20as%20a%20public-key%2Fhash%5Cn%20%20attribute%20of%20JSON%20object%20which%20is%20discoverable%20via%20WebFinger%20using%20the%20client%20global%20identifier%2C%5Cn%20%20e.g.%2C%20https%3A%2F%2Fexample.com%2F.well-known%2Fwebfinger%3Fresource%3Dacct%3A_fhir-client.sandbox.example.com%26rel%3Dpublic-key%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0ASTS%3C-PP%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FSTS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0ASTS-%3ESTS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A3.%20IdP%2FSTS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_fhir-client.sandbox.example.com%0APP%3C-STS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0APP-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20verify%20the%20act%7Bsub%7D%20claim%20%E2%80%94%20the%20client%20is%20authenticated%20using%5Cn%20%20%20%20%20%20%20the%20WebFinger%20protocol%20when%20the%20public-key%2Fhash%20attribute%20value%5Cn%20%20%20%20%20%20%20matches%20the%20hash%20of%20the%20client's%20public%20key%5Cn%20%20%20%204.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%0ARP-%3EPP%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1935" height="1369"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 50.815047804 L 254.26610218117185 1315.913715684" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 50.815047804 L 881.5769793928906 1315.913715684" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 50.815047804 L 1398.1367166964062 1315.913715684" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 210.38076818064158 10.253481456000003 L 298.15143618170214 10.253481456000003 L 298.15143618170214 50.815047804 L 210.38076818064158 50.815047804 L 210.38076818064158 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="226.74110256264157" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 748.9083106603047 10.253481456000003 L 1014.2456481254765 10.253481456000003 L 1014.2456481254765 50.815047804 L 748.9083106603047 50.815047804 L 748.9083106603047 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="765.2686450423047" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1372.0180491082294 10.253481456000003 L 1424.255384284583 10.253481456000003 L 1424.255384284583 50.815047804 L 1372.0180491082294 50.815047804 L 1372.0180491082294 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1388.3783834902295" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 210.38076818064158 1315.913715684 L 298.15143618170214 1315.913715684 L 298.15143618170214 1356.475282032 L 210.38076818064158 1356.475282032 L 210.38076818064158 1315.913715684 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="226.74110256264157" y="1341.396632832" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 748.9083106603047 1315.913715684 L 1014.2456481254765 1315.913715684 L 1014.2456481254765 1356.475282032 L 748.9083106603047 1356.475282032 L 748.9083106603047 1315.913715684 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="765.2686450423047" y="1341.396632832" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1372.0180491082294 1315.913715684 L 1424.255384284583 1315.913715684 L 1424.255384284583 1356.475282032 L 1372.0180491082294 1356.475282032 L 1372.0180491082294 1315.913715684 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1388.3783834902295" y="1341.396632832" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 487.4220954823437 80.97234620399999 L 500.9928797623437 94.54313048399999 L 500.9928797623437 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 487.4220954823437 80.97234620399999 L 487.4220954823437 94.54313048399999 L 500.9928797623437 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 374.81687661640626 168.428511564 L 1374.766297889375 168.428511564 L 1388.337082169375 181.999295844 L 1388.337082169375 323.738598324 L 374.81687661640626 323.738598324 L 374.81687661640626 168.428511564 M 1374.766297889375 168.428511564 L 1374.766297889375 181.999295844 L 1388.337082169375 181.999295844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="189.538620444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="204.617269644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="219.695918844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the subject of the public client certificate (OU and CN attributes) is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="234.774568044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_fhir-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="249.853217244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="280.01051564399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the hash of the client's public key is published on the client domain (usually identical to the IdP host domain) as a public-key/hash</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="295.0891648439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  attribute of JSON object which is discoverable via WebFinger using the client global identifier,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="395.92698549640625" y="310.1678140439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.9936511458203" y="310.1678140439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.8936507643506" y="310.1678140439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">example.com/.well-known/webfinger?resource=acct:_fhir-client.sandbox.example.com&amp;rel=public-key</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1146.7099421669923 346.356572124 L 1635.9927069458204 346.356572124 L 1649.5634912258204 359.927356404 L 1649.5634912258204 441.352062084 L 1146.7099421669923 441.352062084 L 1146.7099421669923 346.356572124 M 1635.9927069458204 346.356572124 L 1635.9927069458204 359.927356404 L 1649.5634912258204 359.927356404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="367.46668100400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="382.54533020400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="397.623979404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="412.702628604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="427.78127780399996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="294.43473730351565" y="463.970035884" width="363.4069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="479.048685084" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="494.12733428399997" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="509.20598348399994" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="524.2846326839999" width="257.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="539.3632818839999" width="546.9736069670313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="477.540820164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="492.619469364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="507.69811856399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="522.7767677639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="537.8554169639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="552.9340661639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 558.965525844 L 266.68085668917183 558.965525844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,558.965525844) translate(-254.26610218117185,-558.965525844)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 552.682755344 L 254.26610218117185 558.965525844 L 266.83164318117184 565.248296344 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="581.5834996440001" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="596.6621488440001" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="611.740798044" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="626.819447244" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="595.1542839240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="610.232933124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="625.311582324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="640.390231524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 646.421691204 L 314.58069898117185 646.421691204 L 314.58069898117185 666.023935164 L 266.68085668917183 666.023935164" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,666.023935164) translate(-254.26610218117185,-666.023935164)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 659.741164664 L 254.26610218117185 666.023935164 L 266.83164318117184 672.306705664 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="688.641908964" width="505.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="703.720558164" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="718.7992073639999" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="733.8778565639999" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="748.9565057639999" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="764.0351549639998" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="779.1138041639998" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="794.1924533639998" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="809.2711025639998" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="824.3497517639997" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="839.4284009639997" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="854.5070501639997" width="604.1902817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="869.5856993639997" width="601.9069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="702.212693244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="717.291342444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="732.3699916439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="747.4486408439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="762.5272900439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="777.6059392439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="792.6845884439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="807.7632376439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="822.8418868439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="837.9205360439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="852.9991852439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="868.0778344439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="883.1564836439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _fhir-client.sandbox.example.com</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 889.187943324 L 314.58069898117185 889.187943324 L 314.58069898117185 908.790187284 L 266.68085668917183 908.790187284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,908.790187284) translate(-254.26610218117185,-908.790187284)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 902.507416784 L 254.26610218117185 908.790187284 L 266.83164318117184 915.072957784 Z"/></g></g><g><g><rect fill="white" stroke="none" x="341.6764060046875" y="931.408161084" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="946.486810284" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="961.5654594839999" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="976.6441086839999" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="991.7227578839999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="990.2148929639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="1005.2935421639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 1011.325001844 L 869.1622248848906 1011.325001844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,1011.325001844) translate(-881.5769793928906,-1011.325001844)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.0114383928906 1005.042231344 L 881.5769793928906 1011.325001844 L 869.0114383928906 1017.607772344 Z"/></g></g><g><g><rect fill="white" stroke="none" x="910.8033789117187" y="1033.9429756440002" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="913.0651762917187" y="1047.5137599240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 1053.545219604 L 1385.7219621884062 1053.545219604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1398.1367166964062,1053.545219604) translate(-1398.1367166964062,-1053.545219604)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1385.5711756964063 1047.262449104 L 1398.1367166964062 1053.545219604 L 1385.5711756964063 1059.827990104 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1076.163193404" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1091.2418426039999" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1106.3204918039999" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1121.3991410039998" width="489.70691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1136.4777902039998" width="514.0902756682032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1151.5564394039998" width="352.3402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1166.6350886039997" width="409.1236008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1181.7137378039997" width="484.54025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1089.733977684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1104.8126268839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1119.8912760839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1134.9699252839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the act{sub} claim — the client is authenticated using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1150.0485744839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       the WebFinger protocol when the public-key/hash attribute value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1165.1272236839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       matches the hash of the client's public key</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1180.2058728839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1195.2845220839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       its identifier and verify that the IdP matches the token issuer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 1201.315981764 L 1458.4513134964063 1201.315981764 L 1458.4513134964063 1220.918225724 L 1410.5514712044062 1220.918225724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1398.1367166964062,1220.918225724) translate(-1398.1367166964062,-1220.918225724)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1410.7022576964061 1214.635455224 L 1398.1367166964062 1220.918225724 L 1410.7022576964061 1227.200996224 Z"/></g></g><g><g><rect fill="white" stroke="none" x="899.4200476128906" y="1243.536199524" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928905" y="1257.106983804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 1263.138443484 L 893.9917339008906 1263.138443484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,1263.138443484) translate(-881.5769793928906,-1263.138443484)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.1425203928907 1256.855672984 L 881.5769793928906 1263.138443484 L 894.1425203928907 1269.421213984 Z"/></g></g></g></g></svg>