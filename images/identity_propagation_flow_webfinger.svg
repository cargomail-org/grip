<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1903" height="1354"><desc>participant%20%22IdP%2FSTS%22%20as%20STS%0Aparticipant%20%22Propagation%20Proxy%20(RS%20%2B%20Client)%22%20as%20PP%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3AIdP%2FSTS%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20PP%3APropagation%20Proxy%3A%5Cn%E2%80%A2%20supports%20RFC%208705%20%E2%80%94%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20e.g.%2C%20OU%3D_fhir-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FSTS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20hash%20of%20the%20client's%20public%20key%20is%20published%20on%20the%20client%20domain%20(usually%20identical%20to%20the%20IdP%20host%20domain)%20as%20a%20publicKey%5Cn%20%20attribute%20of%20JSON%20object%20which%20is%20discoverable%20via%20Webfinger%20using%20the%20client%20global%20identifier%2C%5Cn%20%20e.g.%2C%20https%3A%2F%2Fexample.com%2F.well-known%2Fwebfinger%3Fresource%3Dacct%3A_fhir-client.sandbox.example.com%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0ASTS%3C-PP%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FSTS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0ASTS-%3ESTS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A3.%20IdP%2FSTS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_fhir-client.sandbox.example.com%0APP%3C-STS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0APP-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20verify%20the%20act%7Bsub%7D%20claim%20%E2%80%94%20the%20client%20is%20authenticated%20using%5Cn%20%20%20%20%20%20%20the%20WebFinger%20protocol%20when%20the%20publicKeyHash%20attribute%20value%5Cn%20%20%20%20%20%20%20matches%20the%20hash%20of%20the%20client's%20public%20key%5Cn%20%20%20%204.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%0ARP-%3EPP%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1903" height="1354"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 50.815047804 L 229.7494395835156 1300.8350664840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 50.815047804 L 857.0603167952344 1300.8350664840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1373.62005409875 50.815047804 L 1373.62005409875 1300.8350664840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 10.253481456000003 L 273.6347735840459 10.253481456000003 L 273.6347735840459 50.815047804 L 185.86410558298533 50.815047804 L 185.86410558298533 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 724.3916480626484 10.253481456000003 L 989.7289855278202 10.253481456000003 L 989.7289855278202 50.815047804 L 724.3916480626484 50.815047804 L 724.3916480626484 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="740.7519824446484" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1347.5013865105732 10.253481456000003 L 1399.7387216869267 10.253481456000003 L 1399.7387216869267 50.815047804 L 1347.5013865105732 50.815047804 L 1347.5013865105732 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1363.8617208925732" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 1300.8350664840002 L 273.6347735840459 1300.8350664840002 L 273.6347735840459 1341.3966328320003 L 185.86410558298533 1341.3966328320003 L 185.86410558298533 1300.8350664840002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="1326.3179836320003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 724.3916480626484 1300.8350664840002 L 989.7289855278202 1300.8350664840002 L 989.7289855278202 1341.3966328320003 L 724.3916480626484 1341.3966328320003 L 724.3916480626484 1300.8350664840002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="740.7519824446484" y="1326.3179836320003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1347.5013865105732 1300.8350664840002 L 1399.7387216869267 1300.8350664840002 L 1399.7387216869267 1341.3966328320003 L 1347.5013865105732 1341.3966328320003 L 1347.5013865105732 1300.8350664840002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1363.8617208925732" y="1326.3179836320003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 438.3887702870312 80.97234620399999 L 451.9595545670312 94.54313048399999 L 451.9595545670312 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 438.3887702870312 80.97234620399999 L 438.3887702870312 94.54313048399999 L 451.9595545670312 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 372.5835392140625 168.42851156400002 L 1327.9663100964062 168.42851156400002 L 1341.5370943764062 181.99929584400002 L 1341.5370943764062 308.65994912400004 L 372.5835392140625 308.65994912400004 L 372.5835392140625 168.42851156400002 M 1327.9663100964062 168.42851156400002 L 1327.9663100964062 181.99929584400002 L 1341.5370943764062 181.99929584400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="189.53862044400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="204.61726964400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705 — the subject of the public client certificate (OU and CN attributes) is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="219.69591884400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_fhir-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="234.77456804400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="249.85321724400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="264.93186644400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the hash of the client's public key is published on the client domain (usually identical to the IdP host domain) as a publicKey</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="280.01051564400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  attribute of JSON object which is discoverable via Webfinger using the client global identifier,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="393.6936480940625" y="295.08916484400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="482.76031374347656" y="295.08916484400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="492.66031336200683" y="295.08916484400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">example.com/.well-known/webfinger?resource=acct:_fhir-client.sandbox.example.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1122.193279569336 331.27792292400005 L 1611.4760443481641 331.27792292400005 L 1625.0468286281641 344.84870720400005 L 1625.0468286281641 426.27341288400004 L 1122.193279569336 426.27341288400004 L 1122.193279569336 331.27792292400005 M 1611.4760443481641 331.27792292400005 L 1611.4760443481641 344.84870720400005 L 1625.0468286281641 344.84870720400005" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.303388449336" y="352.3880318040001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.303388449336" y="367.46668100400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.303388449336" y="382.54533020400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.303388449336" y="397.623979404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.303388449336" y="412.702628604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="269.9180747058594" y="448.89138668400005" width="363.4069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="463.970035884" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="479.048685084" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="494.12733428399997" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="509.20598348399994" width="257.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="524.2846326839999" width="546.9736069670313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="462.46217096400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="477.540820164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="492.619469364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="507.69811856399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="522.7767677639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="537.8554169639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 543.886876644 L 242.16419409151558 543.886876644" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,543.886876644) translate(-229.7494395835156,-543.886876644)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 537.6041061440001 L 229.7494395835156 543.886876644 L 242.3149805835156 550.169647144 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="566.5048504440001" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="581.5834996440001" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="596.6621488440001" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="611.740798044" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="580.0756347240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="595.1542839240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="610.232933124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="625.311582324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 631.343042004 L 290.0640363835156 631.343042004 L 290.0640363835156 650.945285964 L 242.16419409151558 650.945285964" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,650.945285964) translate(-229.7494395835156,-650.945285964)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 644.6625154640001 L 229.7494395835156 650.945285964 L 242.3149805835156 657.228056464 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="673.563259764" width="505.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="688.641908964" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="703.720558164" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="718.7992073639999" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="733.8778565639999" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="748.9565057639999" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="764.0351549639998" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="779.1138041639998" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="794.1924533639998" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="809.2711025639998" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="824.3497517639997" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="839.4284009639997" width="604.1902817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="854.5070501639997" width="601.9069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="687.134044044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="702.212693244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="717.291342444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="732.3699916439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="747.4486408439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="762.5272900439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="777.6059392439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="792.6845884439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="807.7632376439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="822.8418868439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="837.9205360439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="852.9991852439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="868.0778344439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _fhir-client.sandbox.example.com</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 874.109294124 L 290.0640363835156 874.109294124 L 290.0640363835156 893.711538084 L 242.16419409151558 893.711538084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,893.711538084) translate(-229.7494395835156,-893.711538084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 887.4287675840001 L 229.7494395835156 893.711538084 L 242.3149805835156 899.994308584 Z"/></g></g><g><g><rect fill="white" stroke="none" x="317.15974340703127" y="916.329511884" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="931.408161084" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="946.486810284" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="961.5654594839999" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="976.6441086839999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="929.900296164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="990.2148929639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 996.246352644 L 844.6455622872344 996.246352644" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(857.0603167952344,996.246352644) translate(-857.0603167952344,-996.246352644)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 844.4947757952343 989.963582144 L 857.0603167952344 996.246352644 L 844.4947757952343 1002.529123144 Z"/></g></g><g><g><rect fill="white" stroke="none" x="886.2867163140625" y="1018.8643264440001" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.5485136940624" y="1032.4351107240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 1038.466570404 L 1361.20529959075 1038.466570404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1373.62005409875,1038.466570404) translate(-1373.62005409875,-1038.466570404)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1361.05451309875 1032.1837999040001 L 1373.62005409875 1038.466570404 L 1361.05451309875 1044.749340904 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1061.0845442040002" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1076.1631934040001" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1091.241842604" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1106.320491804" width="489.70691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1121.399141004" width="506.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1136.477790204" width="352.3402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1151.556439404" width="409.1236008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1391.46312231875" y="1166.635088604" width="484.54025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1074.6553284840002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1089.7339776840001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1104.812626884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1119.891276084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the act{sub} claim — the client is authenticated using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1134.969925284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       the WebFinger protocol when the publicKeyHash attribute value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1150.048574484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       matches the hash of the client's public key</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1165.127223684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1393.72491969875" y="1180.205872884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       its identifier and verify that the IdP matches the token issuer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1373.62005409875 1186.2373325640003 L 1433.93465089875 1186.2373325640003 L 1433.93465089875 1205.8395765240002 L 1386.03480860675 1205.8395765240002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1373.62005409875,1205.8395765240002) translate(-1373.62005409875,-1205.8395765240002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1386.18559509875 1199.5568060240003 L 1373.62005409875 1205.8395765240002 L 1386.18559509875 1212.1223470240002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="874.9033850152343" y="1228.4575503240003" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="877.1651823952343" y="1242.0283346040003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1373.62005409875 1248.0597942840002 L 869.4750713032344 1248.0597942840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(857.0603167952344,1248.0597942840002) translate(-857.0603167952344,-1248.0597942840002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.6258577952344 1241.7770237840002 L 857.0603167952344 1248.0597942840002 L 869.6258577952344 1254.3425647840002 Z"/></g></g></g></g></svg>