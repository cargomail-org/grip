<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2294" height="1569"><desc>participant%20%22IdP%22%20as%20IdP%0Aparticipant%20%22Identity%20Propagation%20Proxy%20(IdPP)%22%20as%20Propagator%0Aparticipant%20%22RP%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20IdP%3AIdP%3A%5Cn%E2%80%A2%20provides%20an%20STS%20service%20that%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Propagator%3AIdentity%20Propagator%20Proxy%3A%5Cn%E2%80%A2%20runs%20as%20a%20service%20on%20its%20own%20URI%20with%20the%20ability%20to%20issue%20actor%20and%20authentication%20tokens%5Cn%E2%80%A2%20generates%20its%20own%20public%20and%20private%20key%20pair%20to%20sign%20assertions%20and%20authenticate%20to%20IdPs%20and%20RPs%5Cn%E2%80%A2%20public%20keys%20are%20published%20at%20the%20IdPP%20well-known%20URI%5Cn%E2%80%A2%20client_id%20is%20the%20IdPP%20URI%5Cn%E2%80%A2%20uses%20a%20private_key_jwt%20client%20authentication%20method%20to%20authenticate%20to%20IdPs%20and%20RPs%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20respect%20of%20the%20IdP%20in%20order%20to%20obtain%20an%20access_token_with_user_claims%0Anote%20over%20RP%3ARP%3A%5Cn%E2%80%A2%20is%20a%20resource%20server%20using%20the%20local%20ABAC%20engine%20to%20automate%20authorization%20assessment%0APropagator-%3EPropagator%3A1.%20Generate%20the%20actor_token%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%7D%5Cn%20%20%20%20iss%20is%20the%20client_id%5Cn%20%20%20%20aud%20is%20the%20URI%20that%20identifies%20the%20RP%5Cn%20%20%20%20sub%20is%20the%20client_id%5Cn%20%20%20%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%0APropagator-%3EPropagator%3A2.%20Generate%20the%20authentication_token%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20sub%2C%20aud%2C%20jti%2C%20exp%7D%5Cn%20%20%20%20iss%20is%20the%20client_id%5Cn%20%20%20%20aud%20is%20the%20URI%20that%20identifies%20the%20IdP%5Cn%20%20%20%20sub%20is%20the%20client_id%5Cn%20%20%20%20jti%2C%20exp%20are%20the%20standard%20JWT%20claims%0AIdP%3C-Propagator%3A3.%20Send%20an%20HTTP%20request%20to%20get%20an%20identity_token%20with%20the%20actor_token%20in%20the%20header%5Cn%20%20%20%20using%20the%20private_key_jwt%20client%20authentication%20method%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%2C%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20actor_token%20%3D%20actor_token%2C%5Cn%20%20%20%20%20actor_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0AIdP-%3EIdP%3A4.%20Authorization%20assessment%5Cn%20%20%20%201.%20verify%20the%20authentication_token%20signature%20using%20the%20IdPP%20public%20keys%5Cn%20%20%20%20%20%20%20%20published%20at%20the%20IdPP%20well%20known%20URI%2C%20and%20evaluate%20claims%5Cn%20%20%20%202.%20verify%20the%20actor_token%20signature%20using%20the%20IdPP%20public%20keys%5Cn%20%20%20%20%20%20%20%20published%20at%20the%20IdPP%20well%20known%20URI%2C%20and%20evaluate%20claims%5Cn%20%20%20%203.%20verify%20the%20access_token_with_user_claims%20signature%20and%20evaluate%20claims%20%0A%0AIdP-%3EIdP%3A5.%20STS%20generates%20the%20identity_token%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20identity_token%5Cn%20%20%20%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20aud%20claim%20value%20extracted%20from%20the%20actor_token%5Cn%20%20%20%20sub%20identifies%20the%20principal%20by%20an%20email%20address%20that%20is%20extracted%20from%20the%20access_token_with_user_claims%5Cn%20%20%20%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20act%7Bsub%7D%20is%20the%20sub%20value%20extracted%20from%20the%20actor_token%0APropagator%3C-IdP%3A6.%20Return%20the%20identity_token%0A%0APropagator-%3EPropagator%3A7.%20Generate%20the%20authentication_token%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20sub%2C%20aud%2C%20jti%2C%20exp%7D%5Cn%20%20%20%20iss%20is%20the%20client_id%5Cn%20%20%20%20aud%20is%20the%20URI%20that%20identifies%20the%20RP%5Cn%20%20%20%20sub%20is%20the%20client_id%5Cn%20%20%20%20jti%2C%20exp%20are%20the%20standard%20JWT%20claims%0APropagator-%3ERP%3A8.%20Send%20an%20HTTP%20request%20to%20the%20RP%20with%20the%20identity_token%20in%20the%20header%5Cn%20%20%20%20using%20the%20private_key_jwt%20client%20authentication%20method%5Cn%20%20%20%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20authentication_token%0ARP-%3ERP%3A9.%20Authorization%20assessment%5Cn%20%20%20%201.%20verify%20the%20authentication_token%20signature%20using%20the%20IdPP%20public%20keys%5Cn%20%20%20%20%20%20%20%20published%20at%20the%20IdPP%20well%20known%20URI%2C%20and%20evaluate%20claims%5Cn%20%20%20%202.%20verify%20the%20identity_token%20signature%20and%20evaluate%20claims%0ARP-%3EPropagator%3A10.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2294" height="1569"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 336.93275867531247 50.815047804 L 336.93275867531247 1516.4597500439997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 50.815047804 L 1159.726973289375 1516.4597500439997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1729.8200663057814 50.815047804 L 1729.8200663057814 1516.4597500439997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 309.32242429331245 10.253481456000003 L 364.54309305731243 10.253481456000003 L 364.54309305731243 50.815047804 L 309.32242429331245 50.815047804 L 309.32242429331245 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="325.68275867531247" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1022.7499702062032 10.253481456000003 L 1296.703976372547 10.253481456000003 L 1296.703976372547 50.815047804 L 1022.7499702062032 50.815047804 L 1022.7499702062032 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1039.1103045882032" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Identity Propagation Proxy (IdPP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1703.9347323052511 10.253481456000003 L 1755.7054003063117 10.253481456000003 L 1755.7054003063117 50.815047804 L 1703.9347323052511 50.815047804 L 1703.9347323052511 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1720.2950666872512" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 309.32242429331245 1516.4597500439997 L 364.54309305731243 1516.4597500439997 L 364.54309305731243 1557.0213163919998 L 309.32242429331245 1557.0213163919998 L 309.32242429331245 1516.4597500439997 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="325.68275867531247" y="1541.9426671919998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1022.7499702062032 1516.4597500439997 L 1296.703976372547 1516.4597500439997 L 1296.703976372547 1557.0213163919998 L 1022.7499702062032 1557.0213163919998 L 1022.7499702062032 1516.4597500439997 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1039.1103045882032" y="1541.9426671919998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Identity Propagation Proxy (IdPP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1703.9347323052511 1516.4597500439997 L 1755.7054003063117 1516.4597500439997 L 1755.7054003063117 1557.0213163919998 L 1703.9347323052511 1557.0213163919998 L 1703.9347323052511 1516.4597500439997 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1720.2950666872512" y="1541.9426671919998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 652.755408470625 80.97234620399999 L 666.326192750625 94.54313048399999 L 666.326192750625 130.731888564 L 7.5393246000000005 130.731888564 L 7.5393246000000005 80.97234620399999 M 652.755408470625 80.97234620399999 L 652.755408470625 94.54313048399999 L 666.326192750625 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• provides an STS service that supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 774.9085209035158 153.349862364 L 1530.9746413952346 153.349862364 L 1544.5454256752346 166.920646644 L 1544.5454256752346 278.502650724 L 774.9085209035158 278.502650724 L 774.9085209035158 153.349862364 M 1530.9746413952346 153.349862364 L 1530.9746413952346 166.920646644 L 1544.5454256752346 166.920646644" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="174.45997124399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Identity Propagator Proxy:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="189.53862044399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• runs as a service on its own URI with the ability to issue actor and authentication tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates its own public and private key pair to sign assertions and authenticate to IdPs and RPs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• public keys are published at the IdPP well-known URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• client_id is the IdPP URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses a private_key_jwt client authentication method to authenticate to IdPs and RPs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.0186297835157" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in respect of the IdP in order to obtain an access_token_with_user_claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1379.618282621094 301.120624524 L 2066.451065710469 301.120624524 L 2080.021849990469 314.691408804 L 2080.021849990469 350.880166884 L 1379.618282621094 350.880166884 L 1379.618282621094 301.120624524 M 2066.451065710469 301.120624524 L 2066.451065710469 314.691408804 L 2080.021849990469 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1400.728391501094" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1400.728391501094" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is a resource server using the local ABAC engine to automate authorization assessment</text></g><g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="373.498140684" width="349.3402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="388.57678988400005" width="202.99025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="403.655439084" width="153.4402665129297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="418.734088284" width="284.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="433.81273748399997" width="160.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="448.89138668399994" width="294.25693216234373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="387.0689249640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Generate the actor_token with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="402.14757416400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="417.226223364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    iss is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="432.304872564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    aud is the URI that identifies the RP</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="447.38352176399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    sub is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="462.46217096399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    exp, nbf are the standard JWT claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 468.493630644 L 1220.041570089375 468.493630644 L 1220.041570089375 488.095874604 L 1172.141727797375 488.095874604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1159.726973289375,488.095874604) translate(-1159.726973289375,-488.095874604)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1172.292514289375 481.813104104 L 1159.726973289375 488.095874604 L 1172.292514289375 494.37864510400004 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="510.71384840400003" width="418.1902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="525.792497604" width="193.12360086351563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="540.871146804" width="153.4402665129297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="555.949796004" width="288.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="571.0284452039999" width="160.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="586.1070944039999" width="284.39026346117186" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="524.284632684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Generate the authentication_token with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="539.363281884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, sub, aud, jti, exp}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="554.441931084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    iss is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="569.520580284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    aud is the URI that identifies the IdP</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="584.5992294839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    sub is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="599.6778786839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    jti, exp are the standard JWT claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 605.709338364 L 1220.041570089375 605.709338364 L 1220.041570089375 625.311582324 L 1172.141727797375 625.311582324" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1159.726973289375,625.311582324) translate(-1159.726973289375,-625.311582324)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1172.292514289375 619.0288118240001 L 1159.726973289375 625.311582324 L 1172.292514289375 631.594352824 Z"/></g></g><g><g><rect fill="white" stroke="none" x="436.0763999011719" y="647.929556124" width="624.5069321623438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="663.008205324" width="427.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="678.0868545239999" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="693.1655037239999" width="487.95691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="708.2441529239999" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="723.3228021239998" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="738.4014513239998" width="226.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="436.0763999011719" y="753.4801005239998" width="456.29025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="661.500340404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Send an HTTP request to get an identity_token with the actor_token in the header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="676.578989604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    using the private_key_jwt client authentication method</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="691.6576388039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="706.7362880039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="721.8149372039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="736.8935864039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="751.9722356039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token = actor_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.3381972811719" y="767.0508848039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 773.082344484 L 349.34751318331246 773.082344484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(336.93275867531247,773.082344484) translate(-336.93275867531247,-773.082344484)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 349.49829967531247 766.7995739840001 L 336.93275867531247 773.082344484 L 349.49829967531247 779.365114984 Z"/></g></g><g><g><rect fill="white" stroke="none" x="354.77582689531243" y="795.700318284" width="213.14026346117188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="810.778967484" width="541.4402817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="825.8576166839999" width="471.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="840.9362658839999" width="472.5902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="856.0149150839999" width="471.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="871.0935642839999" width="577.9069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="809.271102564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Authorization assessment</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="824.349751764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the authentication_token signature using the IdPP public keys</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="839.4284009639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        published at the IdPP well known URI, and evaluate claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="854.5070501639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify the actor_token signature using the IdPP public keys</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="869.5856993639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        published at the IdPP well known URI, and evaluate claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="884.6643485639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the access_token_with_user_claims signature and evaluate claims </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 336.93275867531247 890.695808244 L 397.2473554753125 890.695808244 L 397.2473554753125 910.298052204 L 349.34751318331246 910.298052204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(336.93275867531247,910.298052204) translate(-336.93275867531247,-910.298052204)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 349.49829967531247 904.015281704 L 336.93275867531247 910.298052204 L 349.49829967531247 916.580822704 Z"/></g></g><g><g><rect fill="white" stroke="none" x="354.77582689531243" y="932.916026004" width="405.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="947.9946752039999" width="280.0569199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="963.0733244039999" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="978.1519736039999" width="704.8069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="993.2306228039998" width="799.6736191740625" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="1008.3092720039998" width="294.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="354.77582689531243" y="1023.3879212039998" width="445.2402695646875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="946.486810284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. STS generates the identity_token with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="961.5654594839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="976.6441086839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    iss is the URI that identifies who issues the identity_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="991.7227578839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    aud identifies the target service and it is the aud claim value extracted from the actor_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="1006.8014070839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    sub identifies the principal by an email address that is extracted from the access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="1021.8800562839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="357.03762427531245" y="1036.958705484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    act{sub} is the sub value extracted from the actor_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 336.93275867531247 1042.990165164 L 397.2473554753125 1042.990165164 L 397.2473554753125 1062.592409124 L 349.34751318331246 1062.592409124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(336.93275867531247,1062.592409124) translate(-336.93275867531247,-1062.592409124)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 349.49829967531247 1056.309638624 L 336.93275867531247 1062.592409124 L 349.49829967531247 1068.8751796239999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="643.5014029529298" y="1085.210382924" width="209.65692605882813" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="645.7632003329297" y="1098.781167204" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return the identity_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 336.93275867531247 1104.8126268839999 L 1147.3122187813751 1104.8126268839999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1159.726973289375,1104.8126268839999) translate(-1159.726973289375,-1104.8126268839999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1147.1614322893752 1098.529856384 L 1159.726973289375 1104.8126268839999 L 1147.1614322893752 1111.0953973839999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1127.4306006839997" width="418.1902512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1142.5092498839997" width="193.12360086351563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1157.5878990839997" width="153.4402665129297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1172.6665482839996" width="284.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1187.7451974839996" width="160.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1202.8238466839996" width="284.39026346117186" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1141.0013849639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Generate the authentication_token with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1156.0800341639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, sub, aud, jti, exp}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1171.1586833639997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    iss is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1186.2373325639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    aud is the URI that identifies the RP</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1201.3159817639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    sub is the client_id</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1216.3946309639996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    jti, exp are the standard JWT claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 1222.426090644 L 1220.041570089375 1222.426090644 L 1220.041570089375 1242.0283346039998 L 1172.141727797375 1242.0283346039998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1159.726973289375,1242.0283346039998) translate(-1159.726973289375,-1242.0283346039998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1172.292514289375 1235.7455641039999 L 1159.726973289375 1242.0283346039998 L 1172.292514289375 1248.3111051039998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1264.6463084039997" width="534.4069565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1279.7249576039997" width="427.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1177.5700415093752" y="1294.8036068039996" width="497.6902512541406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1278.2170926839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Send an HTTP request to the RP with the identity_token in the header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1293.2957418839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    using the private_key_jwt client authentication method</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.8318388893751" y="1308.3743910839996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    iss is the URI that identifies who issues the authentication_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1159.726973289375 1314.4058507639998 L 1717.4053117977815 1314.4058507639998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1729.8200663057814,1314.4058507639998) translate(-1729.8200663057814,-1314.4058507639998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1717.2545253057815 1308.1230802639998 L 1729.8200663057814 1314.4058507639998 L 1717.2545253057815 1320.6886212639997 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1747.6631345257815" y="1337.0238245639998" width="213.14026346117188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1747.6631345257815" y="1352.1024737639998" width="541.4402817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1747.6631345257815" y="1367.1811229639998" width="471.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1747.6631345257815" y="1382.2597721639997" width="447.47360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1749.9249319057815" y="1350.5946088439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Authorization assessment</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1749.9249319057815" y="1365.6732580439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the authentication_token signature using the IdPP public keys</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1749.9249319057815" y="1380.7519072439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        published at the IdPP well known URI, and evaluate claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1749.9249319057815" y="1395.8305564439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify the identity_token signature and evaluate claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1729.8200663057814 1401.8620161239999 L 1790.1346631057813 1401.8620161239999 L 1790.1346631057813 1421.4642600839998 L 1742.2348208137814 1421.4642600839998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1729.8200663057814,1421.4642600839998) translate(-1729.8200663057814,-1421.4642600839998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1742.3856073057814 1415.1814895839998 L 1729.8200663057814 1421.4642600839998 L 1742.3856073057814 1427.7470305839997 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1199.6700628716799" y="1444.0822338839998" width="490.20691385179686" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.9318602516798" y="1457.6530181639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1729.8200663057814 1463.6844778439997 L 1172.141727797375 1463.6844778439997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1159.726973289375,1463.6844778439997) translate(-1159.726973289375,-1463.6844778439997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1172.292514289375 1457.4017073439998 L 1159.726973289375 1463.6844778439997 L 1172.292514289375 1469.9672483439997 Z"/></g></g></g></g></svg>