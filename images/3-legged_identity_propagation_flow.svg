<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1910" height="1338"><desc>participant%20%22IdP%2FSTS%22%20as%20STS%0Aparticipant%20%22RP%2FClient%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3AIdP%2FSTS%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%2C%5Cn%20%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%2C%5Cn%20%20e.g.%2C%20OU%3D_fhir-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FSTS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0ASTS%3C-Client%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FSTS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0ASTS-%3ESTS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A3.%20IdP%2FSTS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_fhir-client.sandbox.example.com%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-STS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%5Cn%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20%20and%20the%20STS%20host%20domain%20must%20match%0ARP-%3EClient%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1910" height="1338"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 50.815047804 L 254.26610218117185 1285.756417284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 50.815047804 L 881.5769793928906 1285.756417284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 50.815047804 L 1398.1367166964062 1285.756417284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 210.38076818064158 10.253481456000003 L 298.15143618170214 10.253481456000003 L 298.15143618170214 50.815047804 L 210.38076818064158 50.815047804 L 210.38076818064158 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="226.74110256264157" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 831.9666450108906 10.253481456000003 L 931.1873137748906 10.253481456000003 L 931.1873137748906 50.815047804 L 831.9666450108906 50.815047804 L 831.9666450108906 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="848.3269793928906" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1372.0180491082294 10.253481456000003 L 1424.255384284583 10.253481456000003 L 1424.255384284583 50.815047804 L 1372.0180491082294 50.815047804 L 1372.0180491082294 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1388.3783834902295" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 210.38076818064158 1285.756417284 L 298.15143618170214 1285.756417284 L 298.15143618170214 1326.317983632 L 210.38076818064158 1326.317983632 L 210.38076818064158 1285.756417284 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="226.74110256264157" y="1311.239334432" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 831.9666450108906 1285.756417284 L 931.1873137748906 1285.756417284 L 931.1873137748906 1326.317983632 L 831.9666450108906 1326.317983632 L 831.9666450108906 1285.756417284 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="848.3269793928906" y="1311.239334432" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1372.0180491082294 1285.756417284 L 1424.255384284583 1285.756417284 L 1424.255384284583 1326.317983632 L 1372.0180491082294 1326.317983632 L 1372.0180491082294 1285.756417284 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1388.3783834902295" y="1311.239334432" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 487.4220954823437 80.97234620399999 L 500.9928797623437 94.54313048399999 L 500.9928797623437 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 487.4220954823437 80.97234620399999 L 487.4220954823437 94.54313048399999 L 500.9928797623437 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 487.88352700703126 168.42851156399996 L 1261.69964749875 168.42851156399996 L 1275.27043177875 181.99929584399996 L 1275.27043177875 278.502650724 L 487.88352700703126 278.502650724 L 487.88352700703126 168.42851156399996 M 1261.69964749875 168.42851156399996 L 1261.69964749875 181.99929584399996 L 1275.27043177875 181.99929584399996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="189.53862044399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the subject of the public client certificate (OU and CN attributes) is used as a global client identifier,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_fhir-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="508.99363588703125" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1146.7099421669923 301.120624524 L 1635.9927069458204 301.120624524 L 1649.5634912258204 314.691408804 L 1649.5634912258204 396.116114484 L 1146.7099421669923 396.116114484 L 1146.7099421669923 301.120624524 M 1635.9927069458204 301.120624524 L 1635.9927069458204 314.691408804 L 1649.5634912258204 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="352.388031804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="367.46668100399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.8200510469921" y="382.5453302039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="294.43473730351565" y="418.734088284" width="363.4069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="433.81273748399997" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="448.89138668399994" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="463.9700358839999" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="479.0486850839999" width="257.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="294.43473730351565" y="494.12733428399986" width="546.9736069670313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="432.304872564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="447.38352176399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="462.46217096399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="477.5408201639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="492.6194693639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.69653468351567" y="507.69811856399986" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 513.729578244 L 266.68085668917183 513.729578244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,513.729578244) translate(-254.26610218117185,-513.729578244)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 507.44680774399995 L 254.26610218117185 513.729578244 L 266.83164318117184 520.012348744 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="536.3475520439999" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="551.4262012439999" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="566.5048504439999" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="581.5834996439999" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="549.9183363239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="564.9969855239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="580.0756347239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="595.1542839239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 601.185743604 L 314.58069898117185 601.185743604 L 314.58069898117185 620.787987564 L 266.68085668917183 620.787987564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,620.787987564) translate(-254.26610218117185,-620.787987564)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 614.505217064 L 254.26610218117185 620.787987564 L 266.83164318117184 627.070758064 Z"/></g></g><g><g><rect fill="white" stroke="none" x="272.1091704011718" y="643.4059613640001" width="505.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="658.484610564" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="673.563259764" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="688.641908964" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="703.720558164" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="718.7992073639999" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="733.8778565639999" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="748.9565057639999" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="764.0351549639998" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="779.1138041639998" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="794.1924533639998" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="809.2711025639998" width="604.1902817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="824.3497517639997" width="601.9069565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="272.1091704011718" y="839.4284009639997" width="551.9236191740625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="656.9767456440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="672.055394844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="687.134044044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="702.212693244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="717.291342444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="732.3699916439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="747.4486408439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="762.5272900439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="777.6059392439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="792.6845884439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="807.7632376439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="822.8418868439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="837.9205360439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _fhir-client.sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3709677811718" y="852.9991852439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 859.0306449240001 L 314.58069898117185 859.0306449240001 L 314.58069898117185 878.6328888840001 L 266.68085668917183 878.6328888840001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(254.26610218117185,878.6328888840001) translate(-254.26610218117185,-878.6328888840001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 266.83164318117184 872.3501183840001 L 254.26610218117185 878.6328888840001 L 266.83164318117184 884.915659384 Z"/></g></g><g><g><rect fill="white" stroke="none" x="341.6764060046875" y="901.250862684" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="916.329511884" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="931.408161084" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="946.486810284" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="341.6764060046875" y="961.5654594839999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="914.821646964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="929.900296164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.93820338468754" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 254.26610218117185 981.167703444 L 869.1622248848906 981.167703444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,981.167703444) translate(-881.5769793928906,-981.167703444)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.0114383928906 974.8849329440001 L 881.5769793928906 981.167703444 L 869.0114383928906 987.450473944 Z"/></g></g><g><g><rect fill="white" stroke="none" x="910.8033789117187" y="1003.785677244" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="913.0651762917187" y="1017.356461524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 881.5769793928906 1023.387921204 L 1385.7219621884062 1023.387921204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1398.1367166964062,1023.387921204) translate(-1398.1367166964062,-1023.387921204)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1385.5711756964063 1017.105150704 L 1398.1367166964062 1023.387921204 L 1385.5711756964063 1029.670691704 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1046.005895004" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1061.084544204" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1076.163193404" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1091.2418426039999" width="409.1236008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1106.3204918039999" width="489.20691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1121.3991410039998" width="38.20692911058594" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1136.4777902039998" width="371.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1415.9797849164063" y="1151.5564394039998" width="319.1902512541406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1059.576679284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1074.655328484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1089.733977684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1104.8126268839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1119.8912760839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        its identifier and verify that the IdP matches the token issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1134.9699252839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1150.0485744839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.2415822964062" y="1165.1272236839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        and the STS host domain must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 1171.1586833640001 L 1458.4513134964063 1171.1586833640001 L 1458.4513134964063 1190.760927324 L 1410.5514712044062 1190.760927324" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1398.1367166964062,1190.760927324) translate(-1398.1367166964062,-1190.760927324)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1410.7022576964061 1184.478156824 L 1398.1367166964062 1190.760927324 L 1410.7022576964061 1197.043697824 Z"/></g></g><g><g><rect fill="white" stroke="none" x="899.4200476128906" y="1213.378901124" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="901.6818449928905" y="1226.949685404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.1367166964062 1232.981145084 L 893.9917339008906 1232.981145084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(881.5769793928906,1232.981145084) translate(-881.5769793928906,-1232.981145084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.1425203928907 1226.698374584 L 881.5769793928906 1232.981145084 L 894.1425203928907 1239.263915584 Z"/></g></g></g></g></svg>