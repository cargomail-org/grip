<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1716" height="1574"><desc>participant%20%22IdP%2FAS%22%20as%20AS%0Aparticipant%20%22RP%2FClient%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RS%0A%0Abottomparticipants%0A%0Anote%20over%20AS%3AIdP%2FAS%5Cn%E2%80%A2%20AS%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FAS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20self-signed%20or%20CA-signed%20certificate%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20Client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20Client's%20public%20key%20hash%20is%20published%20on%20the%20client%20domain%20using%20DNS%20TXT%20record%2C%5Cn%20%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io.%20IN%20TXT%20%20%22v%3Dgrip1%3B%20h%3Dsha256%3B%20p%3Dd2abde240d7cd3ee6b%20...%20e971%22%0Anote%20over%20RS%3ARS%3A%5Cn%E2%80%A2%20supports%20mTLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20IdP%2FAS%20issuer%20discovery%20mechanism%0AAS%3C-Client%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FAS%20STS%20token%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0AAS-%3EAS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20authenticate%20the%20client%20using%20the%20specified%20credentials%5Cn%20%20%202.%20evaluate%20the%20resource%20parameter%5Cn%20%20%203.%20verify%20the%20subject_token%20signature%5Cn%20%20%204.%20evaluate%20the%20subject_token%20claims%0A%0AAS-%3EAS%3A3.%20IdP%2FAS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-AS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3EClient%3A5.%20Client%20generates%20a%20token%20%E2%80%94%20a%20signed%2C%20using%20the%20Client's%20private%20key%2C%5Cn%20%20%20%20DNS-bound%20assertion%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20jwk%2C%20act%7Bsub%7D%2C%20tokens%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20identifies%20who%20issues%20the%20token%20%E2%80%94%20CN%20from%20public%20Client's%20certificate%2C%5Cn%20%20%20%20%20%20e.g.%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%2C%5Cn%20%20%20%20%20%20e.g.%20User%20Principal%20Name%20(UPN)%20from%20Active%20Directory%20(AD)%5Cn%20%20%20%20%20%20(Client%20impersonates%20the%20user%20by%20using%20their%20email%20address)%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20jwks%20holds%20a%20Client's%20certificate%20public%20key%20in%20the%20JWK%20Set%20format%5Cn%20%20%20%20%20%20(alternatively%20provide%20JWK%20Set%20by%20URI%20using%20jwks_uri%20claim)%5Cn%20%20%20%20%E2%80%A2%20tokens%20holds%20an%20embedded%20JWT%20from%20the%20previous%20step%5Cn%20%20%20%20%20%20and%20optionally%20an%20embedded%20JWT%20from%20the%20previous%20hop%5Cn%20%20%20%20%E2%80%A2%20fingerprint%20(optional)%20contains%20the%20digest%20of%20the%20data%20being%20transmitted%0A%0AClient-%3ERS%3A6.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARS-%3ERS%3A7.%20Authorization%20decision%5Cn%20%20%20%201.%20the%20client%20is%20authenticated%20via%20the%20DNS%5Cn%20%20%20%20%20%20%20using%20the%20TXT%20record%20and%20CN%20from%20the%20public%20Client's%20certificate%5Cn%20%20%20%202.%20verify%20token%20signature%5Cn%20%20%20%203.%20validate%20proof-of-possession%5Cn%20%20%20%204.%20evaluate%20embedded%20token%20from%20the%20AS%5Cn%20%20%20%205.%20(optional)%20evaluate%20embedded%20tokens%20from%20the%20previous%20hops%5Cn%20%20%20%206.%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20and%20the%20CN's%20domain%20part%20from%20the%20public%20Client's%20certificate%20must%20match%0ARS-%3EClient%3A8.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1716" height="1574"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 46.580460486999996 L 265.3619867935156 1525.5446361870002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 745.7375696578385 46.580460486999996 L 745.7375696578385 1525.5446361870002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1227.3280773411718 46.580460486999996 L 1227.3280773411718 1525.5446361870002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray="10.632380846153845,4.607365033333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 231.23168040383885 9.399024668000001 L 299.4922931831924 9.399024668000001 L 299.4922931831924 46.580460486999996 L 231.23168040383885 46.580460486999996 L 231.23168040383885 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="246.22865358733884" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 703.565597237278 9.399024668000001 L 787.9095420783991 9.399024668000001 L 787.9095420783991 46.580460486999996 L 703.565597237278 46.580460486999996 L 703.565597237278 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="718.562570420778" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1204.3561042530393 9.399024668000001 L 1250.3000504293045 9.399024668000001 L 1250.3000504293045 46.580460486999996 L 1204.3561042530393 46.580460486999996 L 1204.3561042530393 9.399024668000001 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1219.3530774365393" y="32.758365387" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 231.23168040383885 1525.5446361870002 L 299.4922931831924 1525.5446361870002 L 299.4922931831924 1562.726072006 L 231.23168040383885 1562.726072006 L 231.23168040383885 1525.5446361870002 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="246.22865358733884" y="1548.9039769060003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 703.565597237278 1525.5446361870002 L 787.9095420783991 1525.5446361870002 L 787.9095420783991 1562.726072006 L 703.565597237278 1562.726072006 L 703.565597237278 1525.5446361870002 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="718.562570420778" y="1548.9039769060003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1204.3561042530393 1525.5446361870002 L 1250.3000504293045 1525.5446361870002 L 1250.3000504293045 1562.726072006 L 1204.3561042530393 1562.726072006 L 1204.3561042530393 1525.5446361870002 Z" stroke-miterlimit="10" stroke-width="2.211535216" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1219.3530774365393" y="1548.9039769060003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 6.91104755 74.224650687 L 511.37304044703126 74.224650687 L 523.8129260370313 86.664536277 L 523.8129260370313 147.481754717 L 6.91104755 147.481754717 L 6.91104755 74.224650687 M 511.37304044703126 74.224650687 L 511.37304044703126 86.664536277 L 523.8129260370313 86.664536277" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="93.575583827" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="107.397678927" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• AS acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="121.219774027" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="26.261980689999973" y="135.041869127" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 413.87830521901043 168.214897367 L 1065.1569485066668 168.214897367 L 1077.5968340966667 180.65478295699998 L 1077.5968340966667 310.582476897 L 413.87830521901043 310.582476897 L 413.87830521901043 168.214897367 M 1065.1569485066668 168.214897367 L 1065.1569485066668 180.65478295699998 L 1077.5968340966667 180.65478295699998" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="187.56583050700002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="201.38792560700003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="215.21002070700004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="229.03211580700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses self-signed or CA-signed certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="242.85421090700007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public Client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="256.67630600700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="270.49840110700006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="284.3204962070001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the Client's public key hash is published on the client domain using DNS TXT record,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="433.2292383590104" y="298.1425913070001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., _smtp-client.foo.127.0.0.1.nip.io. IN TXT  "v=grip1; h=sha256; p=d2abde240d7cd3ee6b ... e971"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 968.8771380976563 331.315619547 L 1473.3391309946876 331.315619547 L 1485.7790165846875 343.755505137 L 1485.7790165846875 418.394818677 L 968.8771380976563 418.394818677 L 968.8771380976563 331.315619547 M 1473.3391309946876 331.315619547 L 1473.3391309946876 343.755505137 L 1485.7790165846875 343.755505137" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="988.2280712376562" y="350.666552687" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="988.2280712376562" y="364.488647787" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports mTLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="988.2280712376562" y="378.310742887" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="988.2280712376562" y="392.132837987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="988.2280712376562" y="405.95493308700003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the IdP/AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="281.7181326618489" y="439.127961327" width="427.89662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.7181326618489" y="452.950056427" width="411.57994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.7181326618489" y="466.772151527" width="191.76329723117186" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.7181326618489" y="480.594246627" width="402.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.7181326618489" y="494.41634172700003" width="211.01329723117186" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.7181326618489" y="508.23843682700004" width="447.66329112765624" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="451.567846917" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/AS STS token endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="465.389942017" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="479.212037117" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="493.03413221700004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="506.85622731700005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.79144692684895" y="520.678322417" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 745.7375696578385 526.207160457 L 276.7421784258489 526.207160457" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,526.207160457) translate(-265.3619867935156,-526.207160457)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 520.4479541653333 L 265.3619867935156 526.207160457 L 276.8803993768489 531.9663667486667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="281.71813266184887" y="546.940303107" width="157.11328807589842" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="560.7623982069999" width="354.7466346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="574.5844933069999" width="229.42996898410155" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="588.4065884069998" width="235.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="602.2286835069998" width="235.7799598288281" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="559.3801886969999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="573.2022837969998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. authenticate the client using the specified credentials</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="587.0243788969998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="600.8464739969997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="614.6685690969997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   4. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 620.197407137 L 320.6503671935156 620.197407137 L 320.6503671935156 638.166130767 L 276.7421784258489 638.166130767" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,638.166130767) translate(-265.3619867935156,-638.166130767)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 632.4069244753333 L 265.3619867935156 638.166130767 L 276.8803993768489 643.9253370586667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="281.71813266184887" y="658.899273417" width="433.0632850241406" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="672.721368517" width="213.54662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="686.5434636169999" width="255.46329417941405" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="700.3655587169999" width="324.9966346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="714.1876538169998" width="365.89662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="728.0097489169998" width="169.59662547824217" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="741.8318440169998" width="270.62996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="755.6539391169997" width="301.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="769.4760342169997" width="251.91329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="783.2981293169996" width="440.84664073703124" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="797.1202244169996" width="193.7299567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="810.9423195169995" width="406.29662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="824.7644146169995" width="368.07994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="838.5865097169994" width="359.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="281.71813266184887" y="852.4086048169994" width="451.7133094382031" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="671.3391590069999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="685.1612541069999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="698.9833492069998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="712.8054443069998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="726.6275394069997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="740.4496345069997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="754.2717296069997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="768.0938247069996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="781.9159198069996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="795.7380149069995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="809.5601100069995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="823.3822051069994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="837.2043002069994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="851.0263953069993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.7914469268489" y="864.8484904069993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 870.3773284470001 L 320.6503671935156 870.3773284470001 L 320.6503671935156 888.3460520770001 L 276.7421784258489 888.3460520770001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(265.3619867935156,888.3460520770001) translate(-265.3619867935156,-888.3460520770001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 276.8803993768489 882.5868457853334 L 265.3619867935156 888.3460520770001 L 276.8803993768489 894.1052583686668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="320.3597952595052" y="909.0791947270001" width="120.07996288058594" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="320.3597952595052" y="922.901289827" width="144.21329417941405" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="320.3597952595052" y="936.723384927" width="370.37996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="320.3597952595052" y="950.5454800269999" width="127.44663158175781" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="320.3597952595052" y="964.3675751269999" width="121.66329875705078" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.4331095245052" y="921.519080317" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.4331095245052" y="935.3411754169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.4331095245052" y="949.1632705169999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.4331095245052" y="962.9853656169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.4331095245052" y="976.8074607169998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 265.3619867935156 982.3362987570001 L 734.3573780255052 982.3362987570001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(745.7375696578385,982.3362987570001) translate(-745.7375696578385,-982.3362987570001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 734.2191570745052 976.5770924653334 L 745.7375696578385 982.3362987570001 L 734.2191570745052 988.0955050486668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1003.0694414070001" width="424.19661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1016.8915365070001" width="344.2799598288281" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1030.713631607" width="304.57994762179686" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1044.535726707" width="460.39662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1058.3578218070002" width="247.4799567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1072.1799169070002" width="219.87996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1086.0020120070003" width="274.44661632296874" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1099.8241071070004" width="375.6133033346875" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1113.6462022070004" width="384.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1127.4682973070005" width="251.91329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1141.2903924070006" width="413.6799537253125" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1155.1124875070007" width="378.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1168.9345826070007" width="359.62996593234374" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1182.7566777070008" width="362.66329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="762.0937155261719" y="1196.5787728070009" width="455.37996593234374" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1015.509326997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Client generates a token — a signed, using the Client's private key,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1029.331422097" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    DNS-bound assertion in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1043.1535171970002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, jwk, act{sub}, tokens}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1056.9756122970002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss identifies who issues the token — CN from public Client's certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1070.7977073970003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1084.6198024970004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1098.4418975970004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1112.2639926970005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      e.g. User Principal Name (UPN) from Active Directory (AD)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1126.0860877970006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (Client impersonates the user by using their email address)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1139.9081828970006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1153.7302779970007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • jwks holds a Client's certificate public key in the JWK Set format</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1167.5523730970008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (alternatively provide JWK Set by URI using jwks_uri claim)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1181.3744681970009" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • tokens holds an embedded JWT from the previous step</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1195.196563297001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      and optionally an embedded JWT from the previous hop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="764.1670297911719" y="1209.018658397001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • fingerprint (optional) contains the digest of the data being transmitted</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 745.7375696578385 1214.547496437 L 801.0259500578386 1214.547496437 L 801.0259500578386 1232.5162200670002 L 757.1177612901719 1232.5162200670002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(745.7375696578385,1232.5162200670002) translate(-745.7375696578385,-1232.5162200670002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 757.2559822411719 1226.7570137753335 L 745.7375696578385 1232.5162200670002 L 757.2559822411719 1238.275426358667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="799.0595153380208" y="1253.2493627170002" width="374.94661632296874" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="801.1328296030208" y="1265.6892483070003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 745.7375696578385 1271.2180863470003 L 1215.9478857088384 1271.2180863470003" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(1227.3280773411718,1271.2180863470003) translate(-1227.3280773411718,-1271.2180863470003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1215.8096647578384 1265.4588800553336 L 1227.3280773411718 1271.2180863470003 L 1215.8096647578384 1276.977292638667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1291.9512289970003" width="153.06330028292967" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1305.7733240970003" width="267.01329723117186" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1319.5954191970004" width="410.59664073703124" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1333.4175142970005" width="166.2299567770703" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1347.2396093970005" width="202.64662853" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1361.0617044970006" width="267.2466346335156" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1374.8837995970007" width="403.41329112765624" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1388.7058946970008" width="304.04662242648436" height="17.96872363"/></g><g><rect fill="white" stroke="none" x="1243.6842232095053" y="1402.5279897970008" width="468.2466346335156" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1304.3911145870004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1318.2132096870005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. the client is authenticated via the DNS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1332.0353047870005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       using the TXT record and CN from the public Client's certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1345.8573998870006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. verify token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1359.6794949870007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1373.5015900870007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. evaluate embedded token from the AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1387.3236851870008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    5. (optional) evaluate embedded tokens from the previous hops</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1401.145780287001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    6. the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1245.7575374745052" y="1414.967875387001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       and the CN's domain part from the public Client's certificate must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1227.3280773411718 1420.496713427 L 1282.6164577411719 1420.496713427 L 1282.6164577411719 1438.4654370570001 L 1238.7082689735053 1438.4654370570001" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(1227.3280773411718,1438.4654370570001) translate(-1227.3280773411718,-1438.4654370570001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1238.8464899245052 1432.7062307653334 L 1227.3280773411718 1438.4654370570001 L 1238.8464899245052 1444.2246433486669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="789.7345031309895" y="1459.1985797070001" width="393.59664073703124" height="17.96872363"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="791.8078173959896" y="1471.6384652970003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1227.3280773411718 1477.1673033370002 L 757.1177612901719 1477.1673033370002" stroke-miterlimit="10" stroke-width="1.1518412583333333" stroke-dasharray=""/><g transform="translate(745.7375696578385,1477.1673033370002) translate(-745.7375696578385,-1477.1673033370002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 757.2559822411719 1471.4080970453335 L 745.7375696578385 1477.1673033370002 L 757.2559822411719 1482.926509628667 Z"/></g></g></g></g></svg>