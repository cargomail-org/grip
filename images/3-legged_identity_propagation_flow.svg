<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1245" height="932"><desc>participant%20%22IdP%2FAS%22%20as%20AS%0Aparticipant%20%22RP%2FClient%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20AS%3AIdP%2FAS%5Cn%E2%80%A2%20AS%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20uses%20self-signed%20or%20CA-signed%20certificate%2C%5Cn%20%20the%20CN%20attribute%20of%20the%20public%20client%20certificate%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20in%20respect%20of%20the%20service%20it%20represents%2C%20e.g.%2C%20CN%3D_smtp-client.foo.127.0.0.1.nip.io%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FAS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%20extension%20of%20OAuth%202.0%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20IdP%2FAS%20issuer%20discovery%20mechanism%0AAS%3C-Client%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FAS%20STS%20token%20endpoint%20using%20mTLS%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0AAS-%3EAS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20authenticate%20the%20client%20using%20the%20specified%20credentials%5Cn%20%20%202.%20evaluate%20the%20resource%20parameter%5Cn%20%20%203.%20verify%20the%20subject_token%20signature%5Cn%20%20%204.%20evaluate%20the%20subject_token%20claims%0A%0AAS-%3EAS%3A3.%20IdP%2FAS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20in%20respect%20of%20the%20service%5Cn%20%20%20%20%20%20it%20represents%2C%20copied%20from%20the%20CN%20attribute%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%2C%20e.g.%2C%20_smtp-client.foo.127.0.0.1.nip.io%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-AS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%5Cn%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20%20and%20the%20IdP%2FAS%20host%20domain%20must%20match%0ARP-%3EClient%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1245" height="932"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 217.58295972234376 33.876698536 L 217.58295972234376 897.3806760560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 589.1227845913542 33.876698536 L 589.1227845913542 897.3806760560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 918.6626094603646 33.876698536 L 918.6626094603646 897.3806760560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 191.80107013434377 6.835654304000002 L 243.36484931034377 6.835654304000002 L 243.36484931034377 33.876698536 L 191.80107013434377 33.876698536 L 191.80107013434377 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.70795972234376" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.0908950033541 6.835654304000002 L 621.1546741793542 6.835654304000002 L 621.1546741793542 33.876698536 L 557.0908950033541 33.876698536 L 557.0908950033541 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="567.9977845913542" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 901.5557200630994 6.835654304000002 L 935.7694988576297 6.835654304000002 L 935.7694988576297 33.876698536 L 901.5557200630994 33.876698536 L 901.5557200630994 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="912.4626096510995" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 191.80107013434377 897.3806760560001 L 243.36484931034377 897.3806760560001 L 243.36484931034377 924.4217202880001 L 191.80107013434377 924.4217202880001 L 191.80107013434377 897.3806760560001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.70795972234376" y="914.3692874880002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.0908950033541 897.3806760560001 L 621.1546741793542 897.3806760560001 L 621.1546741793542 924.4217202880001 L 557.0908950033541 924.4217202880001 L 557.0908950033541 897.3806760560001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="567.9977845913542" y="914.3692874880002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 901.5557200630994 897.3806760560001 L 935.7694988576297 897.3806760560001 L 935.7694988576297 924.4217202880001 L 901.5557200630994 924.4217202880001 L 901.5557200630994 897.3806760560001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="912.4626096510995" y="914.3692874880002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.0262164 53.981564135999996 L 421.0925135246875 53.981564135999996 L 430.1397030446875 63.02875365599999 L 430.1397030446875 107.259457976 L 5.0262164 107.259457976 L 5.0262164 53.981564135999996 M 421.0925135246875 53.981564135999996 L 421.0925135246875 63.02875365599999 L 430.1397030446875 63.02875365599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• AS acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="88.15983565600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="98.21226845600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 376.56604126901044 122.33810717599998 L 792.632338393698 122.33810717599998 L 801.6795279136979 131.38529669599998 L 801.6795279136979 205.773299416 L 376.56604126901044 205.773299416 L 376.56604126901044 122.33810717599998 M 792.632338393698 122.33810717599998 L 792.632338393698 131.38529669599998 L 801.6795279136979 131.38529669599998" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="136.411513096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="146.46394589599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses self-signed or CA-signed certificate,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="156.51637869599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the CN attribute of the public client certificate is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="166.56881149599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  in respect of the service it represents, e.g., CN=_smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="176.62124429599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="186.67367709599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.6394471890104" y="196.72610989599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 706.1058661380208 220.85194861599996 L 1122.1721632627082 220.85194861599996 L 1131.2193527827083 229.89913813599995 L 1131.2193527827083 284.18227525599997 L 706.1058661380208 284.18227525599997 L 706.1058661380208 220.85194861599996 M 1122.1721632627082 220.85194861599996 L 1122.1721632627082 229.89913813599995 L 1131.2193527827083 229.89913813599995" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.1792720580208" y="234.92535453599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.1792720580208" y="244.97778733599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens extension of OAuth 2.0</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.1792720580208" y="255.03022013599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.1792720580208" y="265.08265293599993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.1792720580208" y="275.13508573599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the IdP/AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="229.47833853567712" y="299.26092445599994" width="332.39906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.47833853567712" y="309.31335725599996" width="319.71574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.47833853567712" y="319.365790056" width="148.86573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.47833853567712" y="329.418222856" width="312.7324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.47833853567712" y="339.470655656" width="163.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.47833853567712" y="349.52308845600004" width="347.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="308.30811397599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/AS STS token endpoint using mTLS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="318.360546776" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="328.412979576" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="338.465412376" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="348.51784517600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.98620345567713" y="358.57027797600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 589.1227845913542 362.59125109599995 L 225.85946272767708 362.59125109599995" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(217.58295972234376,362.59125109599995) translate(-217.58295972234376,-362.59125109599995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 225.9599870556771 358.4027374293333 L 217.58295972234376 362.59125109599995 L 225.9599870556771 366.7797647626666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="229.4783385356771" y="377.6699002959999" width="121.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="387.72233309599994" width="275.53239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="397.77476589599996" width="178.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="407.827198696" width="182.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="417.879631496" width="183.04907029410157" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="386.71708981599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="396.76952261599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. authenticate the client using the specified credentials</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="406.821955416" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="416.874388216" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="426.926821016" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   4. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 217.58295972234376 430.9477941359999 L 257.79269092234375 430.9477941359999 L 257.79269092234375 444.01595677599994 L 225.85946272767708 444.01595677599994" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(217.58295972234376,444.01595677599994) translate(-217.58295972234376,-444.01595677599994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 225.9599870556771 439.8274431093333 L 217.58295972234376 444.01595677599994 L 225.9599870556771 448.2044704426666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="229.4783385356771" y="459.0946059759999" width="336.3823985411719" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="469.14703877599993" width="165.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="479.19947157599995" width="198.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="489.25190437599997" width="252.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="499.304337176" width="284.1657237364844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="509.356769976" width="131.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="519.409202776" width="210.14906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="529.461635576" width="234.2157267882422" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="539.5140683760001" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="549.5665011760001" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="559.6189339760001" width="150.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="569.6713667760001" width="315.53239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="579.7237995760001" width="285.8490733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="589.7762323760002" width="279.08241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="229.4783385356771" y="599.8286651760002" width="350.83241074820313" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="468.14179549599993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="478.19422829599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="488.24666109599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="498.299093896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="508.351526696" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="518.403959496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="528.456392296" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="538.508825096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="548.561257896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="558.613690696" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="568.6661234960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="578.7185562960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier in respect of the service</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="588.7709890960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      it represents, copied from the CN attribute of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="598.8234218960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate, e.g., _smtp-client.foo.127.0.0.1.nip.io</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="230.9862034556771" y="608.8758546960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 217.58295972234376 612.8968278159999 L 257.79269092234375 612.8968278159999 L 257.79269092234375 625.9649904559999 L 225.85946272767708 625.9649904559999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(217.58295972234376,625.9649904559999) translate(-217.58295972234376,-625.9649904559999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 225.9599870556771 621.7764767893332 L 217.58295972234376 625.9649904559999 L 225.9599870556771 630.1535041226666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="259.52834158743497" y="641.0436396559999" width="93.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="259.52834158743497" y="651.0960724559999" width="111.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="259.52834158743497" y="661.1485052559999" width="287.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="259.52834158743497" y="671.2009380559999" width="98.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="259.52834158743497" y="681.253370856" width="94.34906571646485" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="261.03620650743494" y="650.0908291759999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="261.03620650743494" y="660.143261976" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="261.03620650743494" y="670.195694776" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="261.03620650743494" y="680.248127576" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="261.03620650743494" y="690.300560376" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 217.58295972234376 694.3215334959999 L 580.8462815860208 694.3215334959999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(589.1227845913542,694.3215334959999) translate(-589.1227845913542,-694.3215334959999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 580.7457572580208 690.1330198293332 L 589.1227845913542 694.3215334959999 L 580.7457572580208 698.5100471626666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="608.2598321058595" y="709.400182696" width="291.26572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="609.7676970258594" y="718.4473722160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 589.1227845913542 722.468345336 L 910.3861064550313 722.468345336" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(918.6626094603646,722.468345336) translate(-918.6626094603646,-722.468345336)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 910.2855821270313 718.2798316693332 L 918.6626094603646 722.468345336 L 910.2855821270313 726.6568590026667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="930.5579882736979" y="737.546994536" width="118.73239701529297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="747.5994273360001" width="147.24906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="757.6518601360001" width="157.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="767.7042929360001" width="260.0990733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="777.7567257360001" width="310.99906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="787.8091585360002" width="24.415729458530272" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="797.8615913360002" width="236.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="930.5579882736979" y="807.9140241360002" width="215.2157267882422" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="746.5941840560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="756.6466168560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="766.6990496560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="776.7514824560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="786.8039152560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        its identifier and verify that the IdP matches the token issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="796.8563480560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="806.9087808560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.0658531936979" y="816.9612136560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        and the IdP/AS host domain must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 918.6626094603646 820.982186776 L 958.8723406603646 820.982186776 L 958.8723406603646 834.050349416 L 926.9391124656979 834.050349416" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(918.6626094603646,834.050349416) translate(-918.6626094603646,-834.050349416)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 927.0396367936979 829.8618357493333 L 918.6626094603646 834.050349416 L 927.0396367936979 838.2388630826667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="601.0181634046876" y="849.1289986160001" width="305.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.5260283246876" y="858.1761881360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 918.6626094603646 862.1971612560001 L 597.3992875966875 862.1971612560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(589.1227845913542,862.1971612560001) translate(-589.1227845913542,-862.1971612560001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 597.4998119246875 858.0086475893333 L 589.1227845913542 862.1971612560001 L 597.4998119246875 866.3856749226668 Z"/></g></g></g></g></svg>