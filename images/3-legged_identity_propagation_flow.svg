<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1224" height="902"><desc>participant%20%22IdP%2FAS%22%20as%20AS%0Aparticipant%20%22RP%2FClient%22%20as%20Client%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20AS%3AIdP%2FAS%5Cn%E2%80%A2%20AS%20acts%20in%20the%20role%20of%20a%20Security%20Token%20Service%20(STS)%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3ARP%2FClient%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%2C%5Cn%20%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%2C%5Cn%20%20e.g.%2C%20OU%3D_smtp-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FAS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20Mutual-TLS%20Client%20Certificate-Bound%20Access%20Tokens%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20IdP%2FAS%20issuer%20discovery%20mechanism%0AAS%3C-Client%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FAS%20STS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0AAS-%3EAS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0AAS-%3EAS%3A3.%20IdP%2FAS%20STS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_smtp-client.sandbox.example.com%5Cn%20%20%20%20%20%20(act%20identifies%20the%20acting%20party%20to%20whom%20authority%20has%20been%20delegated)%0AClient%3C-AS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0AClient-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%5Cn%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20the%20domain%20part%20of%20the%20users's%20email%20address%5Cn%20%20%20%20%20%20%20%20and%20the%20IdP%2FAS%20host%20domain%20must%20match%0ARP-%3EClient%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1224" height="902"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 33.876698536 L 162.49128491765626 867.2233776560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 569.004088556849 33.876698536 L 569.004088556849 867.2233776560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 898.5439134258594 33.876698536 L 898.5439134258594 867.2233776560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 136.70939532965627 6.835654304000002 L 188.27317450565627 6.835654304000002 L 188.27317450565627 33.876698536 L 136.70939532965627 33.876698536 L 136.70939532965627 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="147.61628491765626" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 536.9721989688489 6.835654304000002 L 601.035978144849 6.835654304000002 L 601.035978144849 33.876698536 L 536.9721989688489 33.876698536 L 536.9721989688489 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="547.879088556849" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 881.4370240285942 6.835654304000002 L 915.6508028231245 6.835654304000002 L 915.6508028231245 33.876698536 L 881.4370240285942 33.876698536 L 881.4370240285942 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.3439136165943" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 136.70939532965627 867.2233776560003 L 188.27317450565627 867.2233776560003 L 188.27317450565627 894.2644218880002 L 136.70939532965627 894.2644218880002 L 136.70939532965627 867.2233776560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="147.61628491765626" y="884.2119890880003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 536.9721989688489 867.2233776560003 L 601.035978144849 867.2233776560003 L 601.035978144849 894.2644218880002 L 536.9721989688489 894.2644218880002 L 536.9721989688489 867.2233776560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="547.879088556849" y="884.2119890880003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 881.4370240285942 867.2233776560003 L 915.6508028231245 867.2233776560003 L 915.6508028231245 894.2644218880002 L 881.4370240285942 894.2644218880002 L 881.4370240285942 867.2233776560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.3439136165943" y="884.2119890880003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.0262164 53.981564135999996 L 310.9091639153125 53.981564135999996 L 319.9563534353125 63.02875365599999 L 319.9563534353125 107.259457976 L 5.0262164 107.259457976 L 5.0262164 53.981564135999996 M 310.9091639153125 53.981564135999996 L 310.9091639153125 63.02875365599999 L 319.9563534353125 63.02875365599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/AS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• AS acts in the role of a Security Token Service (STS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="88.15983565600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="19.09962232000001" y="98.21226845600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 318.19734523450524 122.338107176 L 810.7636423591928 122.338107176 L 819.8108318791927 131.38529669599998 L 819.8108318791927 195.720866616 L 318.19734523450524 195.720866616 L 318.19734523450524 122.338107176 M 810.7636423591928 122.338107176 L 810.7636423591928 131.38529669599998 L 819.8108318791927 131.38529669599998" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="136.41151309599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RP/Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="146.46394589599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="156.51637869599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  the subject of the public client certificate (OU and CN attributes) is used as a global client identifier,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="166.56881149599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_smtp-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="176.62124429599993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/AS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="332.2707511545052" y="186.67367709599992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 738.1121701035156 210.799515816 L 1049.928467228203 210.799515816 L 1058.9756567482032 219.84670533599999 L 1058.9756567482032 274.129842456 L 738.1121701035156 274.129842456 L 738.1121701035156 210.799515816 M 1049.928467228203 210.799515816 L 1049.928467228203 219.84670533599999 L 1058.9756567482032 219.84670533599999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="752.1855760235156" y="224.872921736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="752.1855760235156" y="234.925354536" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports Mutual-TLS Client Certificate-Bound Access Tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="752.1855760235156" y="244.97778733599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="752.1855760235156" y="255.03022013599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="752.1855760235156" y="265.082652936" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the IdP/AS issuer discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="191.87315311608072" y="289.208491656" width="246.33239548941407" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="191.87315311608072" y="299.260924456" width="319.71574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="191.87315311608072" y="309.313357256" width="148.86573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="191.87315311608072" y="319.36579005600004" width="312.7324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="191.87315311608072" y="329.41822285600006" width="163.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="191.87315311608072" y="339.4706556560001" width="347.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="298.255681176" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/AS STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="308.308113976" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="318.36054677600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="328.41297957600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="338.4654123760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.38101803608072" y="348.5178451760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 569.004088556849 352.538818296 L 170.76778792298958 352.538818296" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,352.538818296) translate(-162.49128491765626,-352.538818296)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 348.3503046293333 L 162.49128491765626 352.538818296 L 170.8683122509896 356.72733196266665 Z"/></g></g><g><g><rect fill="white" stroke="none" x="174.3866637309896" y="367.617467496" width="121.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="377.66990029600004" width="178.11573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="387.72233309600006" width="182.74906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="397.7747658960001" width="183.04907029410157" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="376.66465701600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="386.71708981600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="396.7695226160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="406.8219554160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 410.842928536 L 202.70101611765625 410.842928536 L 202.70101611765625 423.911091176 L 170.76778792298958 423.911091176" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,423.911091176) translate(-162.49128491765626,-423.911091176)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 419.72257750933335 L 162.49128491765626 423.911091176 L 170.8683122509896 428.0996048426667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="174.3866637309896" y="438.98974037600004" width="336.3823985411719" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="449.04217317600006" width="165.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="459.0946059760001" width="198.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="469.1470387760001" width="252.4324015929297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="479.1994715760001" width="284.1657237364844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="489.25190437600014" width="131.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="499.30433717600016" width="228.41572373648438" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="509.3567699760002" width="234.2157267882422" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="519.4092027760001" width="195.61573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="529.4616355760002" width="342.4490489317969" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="539.5140683760002" width="150.36573594351563" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="549.5665011760002" width="383.96574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="559.6189339760002" width="391.0990733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="174.3866637309896" y="569.6713667760002" width="350.83241074820313" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="448.03692989600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/AS STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="458.0893626960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="468.1417954960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="478.1942282960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="488.24666109600014" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="498.29909389600016" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="508.3515266960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="518.4039594960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="528.4563922960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="538.5088250960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="548.5612578960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="558.6136906960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="568.6661234960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _smtp-client.sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.8945286509896" y="578.7185562960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      (act identifies the acting party to whom authority has been delegated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 582.7395294160001 L 202.70101611765625 582.7395294160001 L 202.70101611765625 595.8076920560001 L 170.76778792298958 595.8076920560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(162.49128491765626,595.8076920560001) translate(-162.49128491765626,-595.8076920560001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 170.8683122509896 591.6191783893333 L 162.49128491765626 595.8076920560001 L 170.8683122509896 599.9962057226668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="221.92315616783853" y="610.886341256" width="93.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="221.92315616783853" y="620.938774056" width="111.88239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="221.92315616783853" y="630.9912068560001" width="287.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="221.92315616783853" y="641.0436396560001" width="98.81573289175782" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="221.92315616783853" y="651.0960724560001" width="94.34906571646485" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.43102108783853" y="619.9335307760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.43102108783853" y="629.9859635760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.43102108783853" y="640.0383963760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.43102108783853" y="650.0908291760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.43102108783853" y="660.1432619760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 162.49128491765626 664.1642350960001 L 560.7275855515156 664.1642350960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(569.004088556849,664.1642350960001) translate(-569.004088556849,-664.1642350960001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 560.6270612235156 659.9757214293334 L 569.004088556849 664.1642350960001 L 560.6270612235156 668.3527487626668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="588.1411360713541" y="679.2428842960002" width="291.26572984" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.6490009913541" y="688.2900738160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 569.004088556849 692.3110469360001 L 890.2674104205261 692.3110469360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(898.5439134258594,692.3110469360001) translate(-898.5439134258594,-692.3110469360001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 890.166886092526 688.1225332693334 L 898.5439134258594 692.3110469360001 L 890.166886092526 696.4995606026669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="910.4392922391927" y="707.3896961360002" width="118.73239701529297" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="717.4421289360002" width="147.24906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="727.4945617360003" width="157.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="737.5469945360003" width="260.0990733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="747.5994273360003" width="310.99906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="757.6518601360003" width="24.415729458530272" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="767.7042929360003" width="236.13239854117188" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="910.4392922391927" y="777.7567257360004" width="215.2157267882422" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="716.4368856560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="726.4893184560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="736.5417512560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="746.5941840560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="756.6466168560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        its identifier and verify that the IdP matches the token issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="766.6990496560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="776.7514824560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        the domain part of the users's email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="911.9471571591927" y="786.8039152560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        and the IdP/AS host domain must match</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 898.5439134258594 790.8248883760002 L 938.7536446258594 790.8248883760002 L 938.7536446258594 803.8930510160002 L 906.8204164311927 803.8930510160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(898.5439134258594,803.8930510160002) translate(-898.5439134258594,-803.8930510160002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 906.9209407591927 799.7045373493335 L 898.5439134258594 803.8930510160002 L 906.9209407591927 808.0815646826669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="580.8994673701823" y="818.9717002160003" width="305.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="582.4073322901822" y="828.0188897360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 898.5439134258594 832.0398628560002 L 577.2805915621823 832.0398628560002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(569.004088556849,832.0398628560002) translate(-569.004088556849,-832.0398628560002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 577.3811158901823 827.8513491893335 L 569.004088556849 832.0398628560002 L 577.3811158901823 836.228376522667 Z"/></g></g></g></g></svg>