<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1882" height="1323"><desc>participant%20%22IdP%2FSTS%22%20as%20STS%0Aparticipant%20%22Propagation%20Proxy%20(RS%20%2B%20Client)%22%20as%20PP%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3AIdP%2FSTS%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20PP%3APropagation%20Proxy%3A%5Cn%E2%80%A2%20supports%20RFC%208705%20%E2%80%94%20the%20subject%20of%20the%20public%20client%20certificate%20(OU%20and%20CN%20attributes)%20is%20used%20as%20a%20global%20client%20identifier%5Cn%20%20e.g.%2C%20OU%3D_fhir-client%2C%20CN%3Dsandbox.example.com%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FSTS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20hash%20of%20the%20client's%20public%20key%20is%20published%20using%20DNS%20TXT%20record%5Cn%20%20e.g.%2C%20_fhir-client.sandbox.example.com.%20IN%20TXT%20%20%22v%3DDANCE1%3B%20h%3Dsha256%3B%20p%3Dd2abde240d7cd3ee6b4b28c54df034b97983a1%20...%20e971%22%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20user%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0ASTS%3C-PP%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FSTS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0ASTS-%3ESTS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A3.%20IdP%2FSTS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20user%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20the%20global%20client%20identifier%20derived%20from%20the%20subject%20of%20the%20client's%5Cn%20%20%20%20%20%20public%20certificate%20in%20the%20OU.CN%20format%2C%20e.g.%2C%20_fhir-client.sandbox.example.com%0APP%3C-STS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0APP-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20verify%20the%20act%7Bsub%7D%20claim%2C%20the%20client%20is%20authenticated%20via%5Cn%20%20%20%20%20%20%20the%20DNS%20using%20the%20TXT%20record%5Cn%20%20%20%204.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20user%20using%5Cn%20%20%20%20%20%20%20its%20identifier%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%0ARP-%3EPP%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1882" height="1323"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 50.815047804 L 229.7494395835156 1270.677768084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 50.815047804 L 857.0603167952344 1270.677768084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1374.7014189764063 50.815047804 L 1374.7014189764063 1270.677768084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 10.253481456000003 L 273.6347735840459 10.253481456000003 L 273.6347735840459 50.815047804 L 185.86410558298533 50.815047804 L 185.86410558298533 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 724.3916480626484 10.253481456000003 L 989.7289855278202 10.253481456000003 L 989.7289855278202 50.815047804 L 724.3916480626484 50.815047804 L 724.3916480626484 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="740.7519824446484" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1348.5827513882296 10.253481456000003 L 1400.820086564583 10.253481456000003 L 1400.820086564583 50.815047804 L 1348.5827513882296 50.815047804 L 1348.5827513882296 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1364.9430857702296" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 1270.677768084 L 273.6347735840459 1270.677768084 L 273.6347735840459 1311.239334432 L 185.86410558298533 1311.239334432 L 185.86410558298533 1270.677768084 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="1296.160685232" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 724.3916480626484 1270.677768084 L 989.7289855278202 1270.677768084 L 989.7289855278202 1311.239334432 L 724.3916480626484 1311.239334432 L 724.3916480626484 1270.677768084 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="740.7519824446484" y="1296.160685232" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1348.5827513882296 1270.677768084 L 1400.820086564583 1270.677768084 L 1400.820086564583 1311.239334432 L 1348.5827513882296 1311.239334432 L 1348.5827513882296 1270.677768084 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1364.9430857702296" y="1296.160685232" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 438.3887702870312 80.97234620399999 L 451.9595545670312 94.54313048399999 L 451.9595545670312 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 438.3887702870312 80.97234620399999 L 438.3887702870312 94.54313048399999 L 451.9595545670312 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 346.9585392140625 168.42851156400002 L 1353.5913100964062 168.42851156400002 L 1367.1620943764062 181.99929584400002 L 1367.1620943764062 293.581299924 L 346.9585392140625 293.581299924 L 346.9585392140625 168.42851156400002 M 1353.5913100964062 168.42851156400002 L 1353.5913100964062 181.99929584400002 L 1367.1620943764062 181.99929584400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="189.538620444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="204.617269644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705 — the subject of the public client certificate (OU and CN attributes) is used as a global client identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="219.695918844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., OU=_fhir-client, CN=sandbox.example.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="234.774568044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="249.853217244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the hash of the client's public key is published using DNS TXT record</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.0686480940625" y="280.01051564399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  e.g., _fhir-client.sandbox.example.com. IN TXT  "v=DANCE1; h=sha256; p=d2abde240d7cd3ee6b4b28c54df034b97983a1 ... e971"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1123.2746444469924 316.199273724 L 1612.5574092258205 316.199273724 L 1626.1281935058205 329.770058004 L 1626.1281935058205 411.194763684 L 1123.2746444469924 411.194763684 L 1123.2746444469924 316.199273724 M 1612.5574092258205 316.199273724 L 1612.5574092258205 329.770058004 L 1626.1281935058205 329.770058004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3847533269923" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3847533269923" y="352.388031804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3847533269923" y="367.46668100399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3847533269923" y="382.5453302039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3847533269923" y="397.6239794039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="269.9180747058594" y="433.8127374840001" width="363.4069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="448.89138668400005" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="463.970035884" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="479.048685084" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="494.12733428399997" width="257.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="269.9180747058594" y="509.20598348399994" width="546.9736069670313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="447.3835217640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="462.46217096400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="477.540820164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="492.619469364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="507.69811856399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="272.1798720858594" y="522.7767677639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 528.8082274440001 L 242.16419409151558 528.8082274440001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,528.8082274440001) translate(-229.7494395835156,-528.8082274440001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 522.5254569440001 L 229.7494395835156 528.8082274440001 L 242.3149805835156 535.090997944 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="551.4262012440001" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="566.5048504440001" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="581.5834996440001" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="596.6621488440001" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="564.9969855240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="580.0756347240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="595.1542839240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="610.232933124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 616.2643928040001 L 290.0640363835156 616.2643928040001 L 290.0640363835156 635.8666367640001 L 242.16419409151558 635.8666367640001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,635.8666367640001) translate(-229.7494395835156,-635.8666367640001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 629.5838662640001 L 229.7494395835156 635.8666367640001 L 242.3149805835156 642.149407264 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="658.484610564" width="505.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="673.563259764" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="688.641908964" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="703.720558164" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="718.7992073639999" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="733.8778565639999" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="748.9565057639999" width="359.25693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="764.0351549639998" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="779.1138041639998" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="794.1924533639998" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="809.2711025639998" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="824.3497517639997" width="604.1902817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="839.4284009639997" width="601.9069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="672.055394844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="687.134044044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="702.212693244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="717.291342444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="732.3699916439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="747.4486408439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="762.5272900439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the user by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="777.6059392439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="792.6845884439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="807.7632376439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="822.8418868439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="837.9205360439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is the global client identifier derived from the subject of the client's</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="852.9991852439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      public certificate in the OU.CN format, e.g., _fhir-client.sandbox.example.com</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 859.0306449240001 L 290.0640363835156 859.0306449240001 L 290.0640363835156 878.6328888840001 L 242.16419409151558 878.6328888840001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,878.6328888840001) translate(-229.7494395835156,-878.6328888840001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 872.3501183840001 L 229.7494395835156 878.6328888840001 L 242.3149805835156 884.915659384 Z"/></g></g><g><g><rect fill="white" stroke="none" x="317.15974340703127" y="901.250862684" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="916.329511884" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="931.408161084" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="946.486810284" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="317.15974340703127" y="961.5654594839999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="914.821646964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="929.900296164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="319.4215407870313" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 981.167703444 L 844.6455622872344 981.167703444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(857.0603167952344,981.167703444) translate(-857.0603167952344,-981.167703444)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 844.4947757952343 974.8849329440001 L 857.0603167952344 981.167703444 L 844.4947757952343 987.450473944 Z"/></g></g><g><g><rect fill="white" stroke="none" x="886.8273987528908" y="1003.785677244" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="889.0891961328907" y="1017.356461524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 857.0603167952344 1023.387921204 L 1362.2866644684063 1023.387921204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1374.7014189764063,1023.387921204) translate(-1374.7014189764063,-1023.387921204)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1362.1358779764064 1017.105150704 L 1374.7014189764063 1023.387921204 L 1362.1358779764064 1029.670691704 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1046.005895004" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1061.084544204" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1076.163193404" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1091.2418426039999" width="457.14026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1106.3204918039999" width="254.55693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1121.3991410039998" width="409.1236008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1392.5444871964064" y="1136.4777902039998" width="484.54025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1059.576679284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1074.655328484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1089.733977684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1104.8126268839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. verify the act{sub} claim, the client is authenticated via</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1119.8912760839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       the DNS using the TXT record</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1134.9699252839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. use WebFinger to locate the IdP for the user using</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1394.8062845764064" y="1150.0485744839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       its identifier and verify that the IdP matches the token issuer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1374.7014189764063 1156.0800341640002 L 1435.0160157764062 1156.0800341640002 L 1435.0160157764062 1175.682278124 L 1387.1161734844063 1175.682278124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1374.7014189764063,1175.682278124) translate(-1374.7014189764063,-1175.682278124)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1387.2669599764063 1169.399507624 L 1374.7014189764063 1175.682278124 L 1387.2669599764063 1181.965048624 Z"/></g></g><g><g><rect fill="white" stroke="none" x="875.4440674540626" y="1198.3002519240001" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="877.7058648340626" y="1211.8710362040001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1374.7014189764063 1217.902495884 L 869.4750713032344 1217.902495884" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(857.0603167952344,1217.902495884) translate(-857.0603167952344,-1217.902495884)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.6258577952344 1211.619725384 L 857.0603167952344 1217.902495884 L 869.6258577952344 1224.185266384 Z"/></g></g></g></g></svg>