<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2015" height="1278"><desc>participant%20%22IdP%2FSTS%22%20as%20STS%0Aparticipant%20%22Propagation%20Proxy%20(RS%20%2B%20Client)%22%20as%20PP%0Aparticipant%20%22RS%22%20as%20RP%0A%0Abottomparticipants%0A%0Anote%20over%20STS%3AIdP%2FSTS%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20PP%3APropagation%20Proxy%3A%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20is%20registered%20at%20the%20IdP%2FSTS%20as%20a%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20client%20in%20respect%20of%20the%20RS%5Cn%E2%80%A2%20the%20hash%20of%20the%20public%20key%20described%20in%20RFC%208705%20is%20published%20using%20.well-known%20or%20DNS%20(DANE)%20mechanism%5Cn%20%20to%20authenticate%20to%20the%20RS%20using%20the%20service%20specific%20client%20identity%20represented%20by%20a%20DNS%20domain%20name%0Anote%20over%20RP%3ARS%3A%5Cn%E2%80%A2%20supports%20RFC%208705%5Cn%E2%80%A2%20uses%20the%20information%20in%20the%20assertion%20to%20identify%20the%20subscriber%5Cn%20%20and%20makes%20authorization%20decisions%20using%20a%20local%20ABAC%20engine%5Cn%E2%80%A2%20should%20support%20the%20service%20discovery%20mechanism%0ASTS%3C-PP%3A1.%20Send%20an%20HTTP%20request%20to%20the%20IdP%2FSTS%20endpoint%5Cn%20%20%20%20%E2%80%A2%20grant_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange%5Cn%20%20%20%20%E2%80%A2%20resource%20%3D%20a%20target%20RS%20URI%5Cn%20%20%20%20%E2%80%A2%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%5Cn%20%20%20%20%E2%80%A2%20subject_token%20%3D%20access_token%5Cn%20%20%20%20%E2%80%A2%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%0ASTS-%3ESTS%3A2.%20Authorization%20decision%3A%5Cn%20%20%201.%20evaluate%20the%20resource%20parameter%5Cn%20%20%202.%20verify%20the%20subject_token%20signature%5Cn%20%20%203.%20evaluate%20the%20subject_token%20claims%0A%0ASTS-%3ESTS%3A3.%20IdP%2FSTS%20generates%20a%20token%20%E2%80%94%20a%20signed%20certificate-bound%20assertion%5Cn%20%20%20%20in%20JWT%20format%20with%20these%20claims%3A%5Cn%20%20%20%20%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20cnf%2C%20act%7Bsub%7D%7D%5Cn%20%20%20%20%E2%80%A2%20iss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20token%5Cn%20%20%20%20%E2%80%A2%20aud%20identifies%20the%20target%20service%20and%20it%20is%20the%20value%20from%5Cn%20%20%20%20%20%20the%20resource%20parameter%5Cn%20%20%20%20%E2%80%A2%20sub%20identifies%20the%20subscriber%20by%20the%20email%20address%5Cn%20%20%20%20%20%20retrieved%20through%20subject_token%20introspection%5Cn%20%20%20%20%E2%80%A2%20exp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cn%20%20%20%20%E2%80%A2%20cnf%20is%20the%20confirmation%20method%20with%20the%20hash%20of%20the%20client%20certificate%5Cn%20%20%20%20%20%20to%20which%20the%20token%20is%20bound%5Cn%20%20%20%20%E2%80%A2%20act%7Bsub%7D%20is%20a%20Base64%20encoded%20hash%20of%20the%20subject%20(DN)%20of%20the%20client's%20public%20certificate%0APP%3C-STS%3A4.%20Return%20the%20token%5Cn%7B%22access_token%22%3Atoken%2C%5Cn%20%22issued_token_type%22%3A%22urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%22%2C%5Cn%20%22token_type%22%3A%22N_A%22%2C%5Cn%20%22expires_in%22%3A3600%7D%0A%0APP-%3ERP%3A5.%20Send%20an%20HTTP%20request%20to%20the%20RS%20with%20the%20token%20using%20mTLS%0ARP-%3ERP%3A6.%20Authorization%20decision%5Cn%20%20%20%201.%20verify%20the%20token%20signature%5Cn%20%20%20%202.%20validate%20proof-of-possession%5Cn%20%20%20%203.%20validate%20the%20act%7Bsub%7D%20claim%5Cn%20%20%20%204.%20use%20WebFinger%20to%20locate%20the%20IdP%20for%20the%20subscriber%20using%20its%20identifier%5Cn%20%20%20%20%20%20%20and%20verify%20that%20the%20IdP%20matches%20the%20token%20issuer%0ARP-%3EPP%3A7.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2015" height="1278"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 50.815047804 L 229.7494395835156 1225.441820484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 929.4269549788281 50.815047804 L 929.4269549788281 1225.441820484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1445.9866922823437 50.815047804 L 1445.9866922823437 1225.441820484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 10.253481456000003 L 273.6347735840459 10.253481456000003 L 273.6347735840459 50.815047804 L 185.86410558298533 50.815047804 L 185.86410558298533 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 796.7582862462422 10.253481456000003 L 1062.095623711414 10.253481456000003 L 1062.095623711414 50.815047804 L 796.7582862462422 50.815047804 L 796.7582862462422 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="813.1186206282422" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1419.868024694167 10.253481456000003 L 1472.1053598705205 10.253481456000003 L 1472.1053598705205 50.815047804 L 1419.868024694167 50.815047804 L 1419.868024694167 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1436.228359076167" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 185.86410558298533 1225.441820484 L 273.6347735840459 1225.441820484 L 273.6347735840459 1266.003386832 L 185.86410558298533 1266.003386832 L 185.86410558298533 1225.441820484 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="202.22443996498532" y="1250.924737632" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 796.7582862462422 1225.441820484 L 1062.095623711414 1225.441820484 L 1062.095623711414 1266.003386832 L 796.7582862462422 1266.003386832 L 796.7582862462422 1225.441820484 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="813.1186206282422" y="1250.924737632" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy (RS + Client)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1419.868024694167 1225.441820484 L 1472.1053598705205 1225.441820484 L 1472.1053598705205 1266.003386832 L 1419.868024694167 1266.003386832 L 1419.868024694167 1225.441820484 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1436.228359076167" y="1250.924737632" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.97234620399999 L 438.3887702870312 80.97234620399999 L 451.9595545670312 94.54313048399999 L 451.9595545670312 145.810537764 L 7.5393246000000005 145.810537764 L 7.5393246000000005 80.97234620399999 M 438.3887702870312 80.97234620399999 L 438.3887702870312 94.54313048399999 L 451.9595545670312 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IdP/STS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 505.35850259296876 168.42851156399996 L 1339.9246230846875 168.42851156399996 L 1353.4954073646875 181.99929584399996 L 1353.4954073646875 278.502650724 L 505.35850259296876 278.502650724 L 505.35850259296876 168.42851156399996 M 1339.9246230846875 168.42851156399996 L 1339.9246230846875 181.99929584399996 L 1353.4954073646875 181.99929584399996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="189.53862044399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Propagation Proxy:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the IdP/STS as a confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a client in respect of the RS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the hash of the public key described in RFC 8705 is published using .well-known or DNS (DANE) mechanism</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.4686114729687" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  to authenticate to the RS using the service specific client identity represented by a DNS domain name</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1188.318249051758 301.120624524 L 1690.0843512329297 301.120624524 L 1703.6551355129297 314.691408804 L 1703.6551355129297 396.116114484 L 1188.318249051758 396.116114484 L 1188.318249051758 301.120624524 M 1690.0843512329297 301.120624524 L 1690.0843512329297 314.691408804 L 1703.6551355129297 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1209.4283579317578" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1209.4283579317578" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports RFC 8705</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1209.4283579317578" y="352.388031804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• uses the information in the assertion to identify the subscriber</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1209.4283579317578" y="367.46668100399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  and makes authorization decisions using a local ABAC engine</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1209.4283579317578" y="382.5453302039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should support the service discovery mechanism</text></g><g><g><rect fill="white" stroke="none" x="306.10139379765627" y="418.734088284" width="363.4069260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="306.10139379765627" y="433.81273748399997" width="502.8402756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="306.10139379765627" y="448.89138668399994" width="234.00693216234376" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="306.10139379765627" y="463.9700358839999" width="491.9402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="306.10139379765627" y="479.0486850839999" width="257.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="306.10139379765627" y="494.12733428399986" width="546.9736069670313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="432.304872564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the IdP/STS endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="447.38352176399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • grant_type = urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="462.46217096399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • resource = a target RS URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="477.5408201639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • requested_token_type = urn:ietf:params:oauth:token-type:jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="492.6194693639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token = access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="308.3631911776563" y="507.69811856399986" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • subject_token_type = urn:ietf:params:oauth:token-type:access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 929.4269549788281 513.729578244 L 242.16419409151558 513.729578244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,513.729578244) translate(-229.7494395835156,-513.729578244)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 507.44680774399995 L 229.7494395835156 513.729578244 L 242.3149805835156 520.012348744 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="536.3475520439999" width="191.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="551.4262012439999" width="280.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="566.5048504439999" width="287.39026346117186" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="581.5834996439999" width="287.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="549.9183363239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Authorization decision:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="564.9969855239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. evaluate the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="580.0756347239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="595.1542839239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   3. evaluate the subject_token claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 601.185743604 L 290.0640363835156 601.185743604 L 290.0640363835156 620.787987564 L 242.16419409151558 620.787987564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,620.787987564) translate(-229.7494395835156,-620.787987564)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 614.505217064 L 229.7494395835156 620.787987564 L 242.3149805835156 627.070758064 Z"/></g></g><g><g><rect fill="white" stroke="none" x="247.5925078035156" y="643.405961364" width="505.0902756682031" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="658.4846105639999" width="260.67358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="673.5632597639999" width="311.92358865648436" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="688.6419089639999" width="397.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="703.7205581639998" width="447.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="718.7992073639998" width="206.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="733.8778565639998" width="403.72360696703123" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="748.9565057639998" width="368.45691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="764.0351549639997" width="307.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="779.1138041639997" width="538.6569565764063" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="794.1924533639997" width="236.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="247.5925078035156" y="809.2711025639996" width="676.5569199553125" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="656.976745644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. IdP/STS generates a token — a signed certificate-bound assertion</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="672.0553948439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    in JWT format with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="687.1340440439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {iss, aud, sub, exp, nbf, cnf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="702.2126932439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • iss is the URI that identifies who issues the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="717.2913424439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • aud identifies the target service and it is the value from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="732.3699916439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      the resource parameter</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="747.4486408439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • sub identifies the subscriber by the email address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="762.5272900439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      retrieved through subject_token introspection</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="777.6059392439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="792.6845884439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • cnf is the confirmation method with the hash of the client certificate</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="807.7632376439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      to which the token is bound</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="249.85430518351558" y="822.8418868439996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    • act{sub} is a Base64 encoded hash of the subject (DN) of the client's public certificate</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 828.873346524 L 290.0640363835156 828.873346524 L 290.0640363835156 848.475590484 L 242.16419409151558 848.475590484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(229.7494395835156,848.475590484) translate(-229.7494395835156,-848.475590484)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 242.3149805835156 842.192819984 L 229.7494395835156 848.475590484 L 242.3149805835156 854.758360984 Z"/></g></g><g><g><rect fill="white" stroke="none" x="353.34306249882815" y="871.093564284" width="146.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="353.34306249882815" y="886.1722134839999" width="175.82359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="353.34306249882815" y="901.2508626839999" width="452.4902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="353.34306249882815" y="916.3295118839999" width="155.30693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="353.34306249882815" y="931.4081610839999" width="148.27359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="355.60485987882817" y="884.664348564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return the token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="355.60485987882817" y="899.7429977639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{"access_token":token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="355.60485987882817" y="914.8216469639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "issued_token_type":"urn:ietf:params:oauth:token-type:jwt",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="355.60485987882817" y="929.9002961639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "token_type":"N_A",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="355.60485987882817" y="944.9789453639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> "expires_in":3600}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 229.7494395835156 951.010405044 L 917.0122004708281 951.010405044" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(929.4269549788281,951.010405044) translate(-929.4269549788281,-951.010405044)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 916.8614139788281 944.727634544 L 929.4269549788281 951.010405044 L 916.8614139788281 957.293175544 Z"/></g></g><g><g><rect fill="white" stroke="none" x="958.6533544976562" y="973.6283788439999" width="458.10693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="960.9151518776562" y="987.1991631239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Send an HTTP request to the RS with the token using mTLS</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 929.4269549788281 993.230622804 L 1433.5719377743437 993.230622804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1445.9866922823437,993.230622804) translate(-1445.9866922823437,-993.230622804)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1433.4211512823438 986.947852304 L 1445.9866922823437 993.230622804 L 1433.4211512823438 999.5133933039999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1015.8485966039999" width="186.65692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1030.927245804" width="231.52359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1046.005895004" width="247.32359781175782" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1061.084544204" width="246.10692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1076.163193404" width="546.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1463.8297605023438" y="1091.2418426039999" width="391.85693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1029.419380884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Authorization decision</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1044.498030084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    1. verify the token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1059.576679284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    2. validate proof-of-possession</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1074.655328484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    3. validate the act{sub} claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1089.733977684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    4. use WebFinger to locate the IdP for the subscriber using its identifier</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1466.0915578823437" y="1104.8126268839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       and verify that the IdP matches the token issuer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1445.9866922823437 1110.844086564 L 1506.3012890823438 1110.844086564 L 1506.3012890823438 1130.446330524 L 1458.4014467903437 1130.446330524" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1445.9866922823437,1130.446330524) translate(-1445.9866922823437,-1130.446330524)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1458.5522332823436 1124.163560024 L 1445.9866922823437 1130.446330524 L 1458.5522332823436 1136.7291010239999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="947.2700231988281" y="1153.064304324" width="480.8736008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="949.531820578828" y="1166.635088604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1445.9866922823437 1172.6665482839999 L 941.8417094868281 1172.6665482839999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(929.4269549788281,1172.6665482839999) translate(-929.4269549788281,-1172.6665482839999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 941.9924959788282 1166.383777784 L 929.4269549788281 1172.6665482839999 L 941.9924959788282 1178.9493187839998 Z"/></g></g></g></g></svg>